class Pairview{constructor(){this._debug=!0,this._remoteDeviceName=null,this._pairMethod=null,this._options=null,this._passkey="",this.confirmSoftkey=null}show(){const e=window.api.l10n.get;window.addEventListener("resize",this),window.addEventListener("keydown",this),this._remoteDeviceName=this._remoteDeviceName||e("unnamed-device"),this.nameLabel.textContent=this._remoteDeviceName,this.debug(`pair method: ${this._pairMethod}`);var t=`passive-pair-${this._pairMethod}`;switch(this.pairDescription.textContent=e(t,{device:this._remoteDeviceName}),this._pairMethod){case"displaypasskey":case"confirmation":this.passkey.textContent=this._passkey,this.comfirmationItem.hidden=!1,this.pinInputItem.hidden=!0,this.pairviewContent.setAttribute("tabindex",0),this.pairviewContent.focus();break;case"enterpincode":this.pinInputItem.hidden=!1,this.comfirmationItem.hidden=!0,this.pinInput.focus();break;case"consent":this.comfirmationItem.hidden=!1,this.pinInputItem.hidden=!0}this.showSoftKey()}showSoftKey(){var e=this.close.bind(this),t=this.pair.bind(this);let i=null;var s={name:"select",l10nId:"select",priority:2,method:this.selectCheckbox.bind(this)},e={name:"cancel",l10nId:"cancel",priority:1,method:e};i="displaypasskey"===this._pairMethod?[e,s]:[e,s,{name:"pair",l10nId:"pair",priority:3,method:t}],this.confirmSoftkey=new SoftkeyPanel({menuClassName:"menu-button",items:i}),this.confirmSoftkey.show()}pair(){this.debug(`press pair button, pair method is ${this._pairMethod}`);var e;switch(this.phonebookCheckbox.checked&&SettingsObserver.setValue([{name:"bluetooth.pbap",value:this._options.address}]),this._pairMethod){case"displaypasskey":this.debug("display passkey"),window.close();break;case"enterpincode":e=this.pinInput.value,this._options.handle.setPinCode(e).then(()=>{this.debug("Resolved setPinCode operation")},e=>{this.debug(`Rejected setPinCode with reason: ${e}`)}),window.close();break;case"confirmation":case"consent":this._options.handle.accept().then(()=>{this.debug(`Resolved in ${this._pairMethod} request`)},e=>{this.debug(`Rejected in ${this._pairMethod} request `+` with reason: ${e}`)}),window.close()}}start(e,t){if(this.debug("start"),this._pairMethod=e,this._options=t,this._remoteDeviceName=t.deviceName,t.handle&&t.handle.passkey){const i=t.handle.passkey;t=i.toString().length,t=t<6?new Array(6-t+1).join("0"):"";this._passkey=t+i}this.pairviewContent=document.getElementById("pair-view-content"),this.nameLabel=document.getElementById("label-name"),this.pairDescription=document.getElementById("pair-description"),this.comfirmationItem=document.getElementById("confirmation-method"),this.pinInputItem=document.getElementById("pin-input-method"),this.passkey=document.getElementById("passkey"),this.pinInput=document.getElementById("pin-input"),this.phonebookCheckbox=document.getElementById("phonebook-checkbox"),window.api.l10n.once(()=>{this.show()})}close(){this.debug("press close button - wait for promise finish"),this._options.handle.reject().then(()=>{this.debug(`Resolved in reject ${this._pairMethod} request.`)},e=>{this.debug(`Rejected in reject ${this._pairMethod} request with reason: ${e}`)}),this.confirmSoftkey.hide(),window.close()}selectCheckbox(){this.phonebookCheckbox.checked=!this.phonebookCheckbox.checked}closeInput(){this.pinInputItem.hidden||this.pinInput.blur()}handleEvent(e){if(e.target)switch(e.type){case"resize":window.innerHeight<200&&this.close();break;case"keydown":this.debug(e.key),"Backspace"!==e.key&&"BrowserBack"!==e.key||(this.close(),e.preventDefault())}}debug(e){this._debug}}