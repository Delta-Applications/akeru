const LockScreen=function(){const n=4,t=[0,0,0,0,0,0,60,180,300,600,900],o=1e3,r=300,s=1500,c=document.getElementById("lock-screen"),l=c.querySelector("#passcode-text"),a=c.querySelectorAll(".code");let i=!1,d=!1,u="",m="",k=0,w=!1,f=null,v=!1,g=null;const L=window.api.l10n.get;function S(){var e;w?(d=!1,e=function(){let e=0,n="";if(w)if(v){var t=Date.now();t>=f&&(e=Math.max(0,h()-Math.floor((t-f)/1e3)));t=new Date(2019,9,9,9,Math.floor(e/60),e%60).toLocaleString(navigator.language,{second:"numeric",minute:"numeric"});n=L("lockscreenColdDown",{n:t})}else switch(k){case 3:case 4:case 5:n=L("lockscreenCheckLockCode",{n:6-k});break;default:n=L("lockscreenInvalidCode")}return{string:n,coldDown:!!e}}(),v?e.coldDown?g=g||setInterval(()=>{S()},o):(v=!1,w=!1,window.clearInterval(g),g=null,setTimeout(()=>{S()},r)):setTimeout(()=>{w=!1,S()},s),function(e){m="0000",c.classList.add("error"),l.textContent=e;for(let e=0;e<a.length;e++)a[e].classList.add("dotted")}(e.string)):function(){m="",c.classList.remove("error"),l.textContent=L("enter-passcode");for(let e=0;e<a.length;e++)a[e].classList.remove("dotted")}()}function h(){var e=Math.min(t.length-1,k);return t[e]}function p(e){e=CallScreen.translateKey(e.key);"9"<e||e<"0"||m.length>=n||(m+=e,{length:e}=m,a[e-1].classList.add("dotted"),e===n&&(m===u?setTimeout(()=>{b(!1),SettingsObserver.setValue([{name:"lockscreen.unlocked",value:!0}]),CallScreen.placeNewCall(),SettingsObserver.setValue([{name:"lockscreen.wrong.code.info",value:{errorTimes:0}}])},r):(d=!0,c.classList.add("error"),SettingsObserver.setValue([{name:"lockscreen.wrong.code.info",value:{errorTimes:k+1,retryTimestamp:Date.now()}}]))))}function e(){return i}function b(e){e?(S(),DtmfHelper.disableDtmf(),c.classList.add("display"),CallScreenHelper.showLockScreenOption(),window.addEventListener("keydown",p)):(DtmfHelper.enableDtmf(),c.classList.remove("display"),window.removeEventListener("keydown",p))}return{init:function(){SettingsObserver.observe("lockscreen.locked",!1,e=>{i=e}),SettingsObserver.observe("lockscreen.passcode-lock.code","",e=>{u=e}),SettingsObserver.observe("lockscreen.wrong.code.info",null,e=>{e&&e.errorTimes?(k=e.errorTimes,f=e.retryTimestamp,v=!!h(k),w=v||d,S()):k&&(k=0,v=!1,w=!1)})},isScreenLocked:e,showLockScreen:b,isLockScreenShown:function(){return c.classList.contains("display")}}}();window.LockScreen=LockScreen;