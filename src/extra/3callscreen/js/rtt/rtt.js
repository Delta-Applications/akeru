const RTT_DISABLED="rtt_disabled",RTT_ALWAYS_VISIBLE="rtt_always_visible",RTT_VISIBLE_DURING_CALL="rtt_visible_during_call",Rtt=function(){const t="ril.rtt.enabled",n="ril.rtt.preferredSettings",s={},l=new Map;let o=0;function e(e){return s[e]}return SettingsObserver.observe(t,!1,e=>{s[t]=e}),SettingsObserver.observe(n,"visible-during-calls",e=>{s[n]=e}),{get settings(){return e(t)?"visible-during-calls"===e(n)?RTT_VISIBLE_DURING_CALL:RTT_ALWAYS_VISIBLE:RTT_DISABLED},enableRttMode:function(e){dump("RTT enableRTTMode");const t=CallsHandler.getConnectedCall();t&&(e&&CallScreen.showToast({messageL10nId:"oem_converting_rtt_call"}),t.sendRttModifyRequest(e))},requestIncomingRtt:function(){dump("RTT requestIncomingRtt");var{incomingCall:e}=CallsHandler;if(e&&e.call){const{call:t}=e;t.addEventListener("statechange",function e(){"incoming"!==t.state&&("connected"===t.state&&(t.capabilities.supportRtt?CallScreen.showToast({messageL10nId:"change-to-rtt-call"}):CallScreen.showToast({messageL10nId:"ans-rtt-failed"})),t.removeEventListener("statechange",e))}),t.answer(1,!0)}},showRttView:function(){dump("RTT showRTTView");var e=CallsHandler.getConnectedCall();if(e){const t=l.get(e);t&&(dump("RTT show"),t.show(),CallScreen.lockScreenWake(),CallsHandler.enableScreenDimFeature(!1))}e=localStorage.getItem("showFirstRtt"),dump("showRttView, first show rtt flg is: "+e),"true"!=e&&CallScreen.showConfirmDialog({title:{id:"rtt",args:{}},body:{id:"oem_first_rtt_call_message"},accept:{name:"ok",l10nId:"ok",priority:3,callback:function(){dump("showRttView, first show rtt. ok"),localStorage.setItem("showFirstRtt","true")}}})},hideRttView:function(){const e=document.querySelector(".rtt-view.display");e&&(e.classList.remove("display"),document.body.focus(),CallScreen.unlockScreenWake(),CallsHandler.enableScreenDimFeature(!0))},addRttView:function(e,t,n){e&&!l.has(e)&&(dump("RTT addRTTView"),n=new RttView({call:e,callId:++o,name:t,durationNode:n}),l.set(e,n))},removeRttView:function(e){if(e){dump("RTT removeRTTView");const t=l.get(e);t.remove(),l.delete(e)}},isRttViewShown:function(){return!!document.querySelector(".rtt-view.display")},resetRtt:function(){o=0,l.clear()},sendRTTmsg:function(){dump("rtt.js sendRTTmsg");var t=CallsHandler.getConnectedCall();if(t){dump("rtt.js sendRTTmsg, exist call");let e=l.get(t);e&&(dump("RTT sendkey sendRTTmsg"),e.sendRTTmsg())}},onrttmodifyresponse:function(e,t){var{status:n}=t,t="full"===e.rttMode;dump(`RTT onrttmodifyresponse status: ${n},isRtt:${t}`),1===n?t&&CallScreen.showToast({messageL10nId:"change-to-voice-call"}):t?CallScreen.showToast({messageL10nId:"voice-call-failed"}):e.emergency?CallScreen.showConfirmDialog({title:{id:"rtt",args:{}},body:{id:"rtt-emegency-upgrade-rejected"},accept:{name:"ok",l10nId:"ok",priority:2}}):CallScreen.showToast({messageL10nId:"rtt-call-failed"})},onrttmodifyrequest:function(e,t){dump("RTT onrttmodifyrequest"),e&&"full"===t.mode&&(e.sendRttModifyResponse(!0),CallScreen.showToast({messageL10nId:"upgrading-rtt"}),dump("RTT onrttmodifyrequest, Play the tone"),TonePlayer.playSequence([[480,620,250]]))}}}();window.Rtt=Rtt;