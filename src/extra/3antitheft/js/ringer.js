"use strict";var Ringer={_ringer:null,_ringTimeoutId:null,init:async function(){this.wakeLock=navigator.b2g.requestWakeLock("high-priority"),await this.initService();var i=await SettingsObserver.getValue("audio.volume.notification");i&&(this._originalVolume=i),await SettingsObserver.setValue([{name:"audio.volume.notification",value:15}]),SoftkeyHelper.init({menuClassName:"menu-button",header:{name:"Ring"},items:[{l10nId:"ringer-dismiss",priority:3,method:function(){Ringer.stop()}}]}),this.ring(),setTimeout(this.stop.bind(this),6e4)},getMedia:function(){return new Promise(i=>{const e=new XMLHttpRequest({mozSystem:!0});e.open("GET",`${window.AppOrigin.getOrigin("shared")}/resources/media/ringtones/ringer_kai.ogg`,!0),e.responseType="blob",e.onload=function(){200<=e.status&&e.status<300?i(e.response):i(null)},e.onerror=function(){i(null)},e.send()})},initService:async function(){const e=["settingsService"];return new Promise(i=>{window.libSession.initService(e).then(()=>{SettingsObserver.init(),i()})})},ring:async function(){this._ringer||(this._ringer=new Audio);var i,e=await this.getMedia();e&&(this._ringer.mozAudioChannelType="ringer",this._ringer.loop=!0,i=new SettingsURL,this._ringer.src=i.set(e),this._ringer.play())},stop:function(){this._ringer&&(this._ringer.pause(),this._ringer.removeAttribute("src"),this.wakeLock&&this.wakeLock.unlock(),SettingsObserver.setValue([{name:"audio.volume.notification",value:this._originalVolume||10}]).then(()=>window.close()))}};window.api.l10n.once(()=>Ringer.init());