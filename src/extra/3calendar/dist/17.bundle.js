(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{634:function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return w});var a=n(0),o=n(21),c=n(163),i=n(26),r=n(51),s=n(2),u=n(48),l=n(94),d=n(599);n(601);function f(e,t,n,a,o,c,i){try{var r=e[c](i),s=r.value}catch(e){return void n(e)}r.done?t(s):Promise.resolve(s).then(a,o)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=a.default.createElement("span",{className:"icon","data-icon":"forward"}),g=a.default.createElement("span",{className:"loading-text p-pri","data-l10n-id":"setting-up-account"}),v=a.default.createElement("progress",null),w=function(e){var t,n;function w(t){var n;return p(h(n=e.call(this,t)||this),"accountList",null),p(h(n),"loginLoading",null),p(h(n),"FOCUS_SELECTOR",".settings-view-focus"),p(h(n),"handleLocalize",function(){n.forceUpdate()}),p(h(n),"successAddAccount",function(){r.a.go(-1),l.a.emit("synccalendar")}),p(h(n),"failedAddAccount",function(e){var t=e.toString();clearTimeout(n.timerId),n.timerId=null,"duplicate_account"===t?r.a.go(-1):n.changeLoginLoadingPage(!1),i.a.showToaster(Object(s.b)(t))}),p(h(n),"showLoginPage",function(e){if(Object(s.H)())if("caldav"===e)r.a.push("/loginCaldav");else{var t={authenticatorId:e};c.a.managerShowLoginPage(t),n.timerId=setTimeout(function(){n.changeLoginLoadingPage(!0)},1e3)}else Toaster.showToast({messageL10nId:"error-account-offline"})}),p(h(n),"changeLoginLoadingPage",function(e){n.accountList.classList.toggle("hidden",e),n.loginLoading.classList.toggle("hidden",!e),n.updateSoftkey(e)}),p(h(n),"updateSoftkey",function(e){o.a.register({left:e?"":"cancel",center:e?"":"select",right:""},document)}),p(h(n),"focus",function(){n.updateSoftkey()}),p(h(n),"handleKeydown",function(e){var t=null;switch(e.key){case"Enter":e.stopPropagation(),e.preventDefault(),n.handlKeydownClick();break;case"ArrowUp":e.stopPropagation(),e.preventDefault(),t=n.findNext(-1);break;case"ArrowDown":e.stopPropagation(),e.preventDefault(),t=n.findNext(1);break;case"Backspace":case"SoftLeft":e.stopPropagation(),e.preventDefault(),r.a.go(-1)}n.changeFocusItem(t)}),p(h(n),"changeFocusItem",function(e){if(e){var t=n.element.querySelector(n.FOCUS_SELECTOR+".focus");t&&t.classList.remove("focus"),e.scrollIntoView(!1),e.classList.add("focus"),e.focus()}}),n.candidates=[],n.timerId=null,n.handleKeydown=n.handleKeydown.bind(h(n)),n}n=e,(t=w).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var y=w.prototype;return y.componentDidMount=function(){var e,t=(e=regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.initAllEvents(),this.updateSoftkey(),(t=this.element.querySelectorAll(".account-item"))[0].classList.add("focus"),t[0].focus(),this.candidates=Array.from(this.element.querySelectorAll(this.FOCUS_SELECTOR));case 6:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(a,o){var c=e.apply(t,n);function i(e){f(c,a,o,i,r,"next",e)}function r(e){f(c,a,o,i,r,"throw",e)}i(void 0)})});return function(){return t.apply(this,arguments)}}(),y.componentWillUnmount=function(){this.removeAllEvents()},y.initAllEvents=function(){window.addEventListener("localized",this.handleLocalize),i.a.on("account-add-success",this.successAddAccount),i.a.on("account-add-fail",this.failedAddAccount),document.addEventListener("keydown",this.handleKeydown)},y.removeAllEvents=function(){window.removeEventListener("localized",this.handleLocalize),i.a.removeListener("account-add-success",this.successAddAccount),i.a.removeListener("account-add-fail",this.failedAddAccount),document.removeEventListener("keydown",this.handleKeydown)},y.handlKeydownClick=function(){var e=this.element.querySelector(".focus");e&&e.click()},y.findNext=function(e){var t=this.candidates;if(!t.length)return null;var n=this.element.querySelector(this.FOCUS_SELECTOR+".focus")||t[0],a=-1;return t.some(function(o,c){return o===n&&(a=(c+t.length+e)%t.length,!0)}),-1===a?null:t[a]},y.renderRemoteCalType=function(){for(var e=this,t=u.a.ACCOUNT.accountType,n=[],o=function(o){var c=t[o];c.using&&n.push(a.default.createElement("li",{className:"account-item settings-view-focus",onClick:function(){e.showLoginPage(c.type)},role:"menuitem",tabindex:"-1"},a.default.createElement("span",{className:"account-text p-pri","data-l10n-id":c.type}),m))},c=0;c<t.length;c++)o(c);return n},y.render=function(){var e=this;return a.default.createElement("div",{id:"add-account",className:"add-account",tabIndex:"-1",ref:function(t){e.element=t},role:"heading","aria-labelledby":"add-account-header"},a.default.createElement(d.a,{view:"add-account-header",headerStr:Object(s.a)("add-account-header")}),a.default.createElement("div",{className:"account-list",ref:function(t){e.accountList=t}},this.renderRemoteCalType()),a.default.createElement("div",{className:"login-loading hidden",ref:function(t){e.loginLoading=t}},g,v))},w}(a.default.Component)}}]);