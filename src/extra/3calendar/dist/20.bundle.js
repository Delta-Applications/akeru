(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{635:function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return y});var a=n(0),r=n(21),l=n(51),s=n(2),o=n(19),i=n(599);n(601);function c(e,t,n,a,r,l,s){try{var o=e[l](s),i=o.value}catch(e){return void n(e)}o.done?t(i):Promise.resolve(i).then(a,r)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=a.default.createElement("span",{id:"username-title",className:"p-sec","data-l10n-id":"field-user"}),f=a.default.createElement("span",{id:"modify-account-password",className:"p-sec","data-l10n-id":"field-password"}),p=a.default.createElement("label",{className:"pack-checkbox-large"},a.default.createElement("input",{name:"showPwd",id:"showPwd",type:"checkbox"}),a.default.createElement("span",{className:"p-pri","data-l10n-id":"show-password"})),m=a.default.createElement("span",{id:"url-title",className:"p-sec","data-l10n-id":"field-full-url"}),v=a.default.createElement("div",{className:"sync-account-body hidden",role:"menuitem",tabIndex:"-1"},a.default.createElement("h1",{className:"sync-account-string","data-l10n-id":"setting-up-account"}),a.default.createElement("p",{className:"sync-progress-container"},a.default.createElement("progress",null))),w=a.default.createElement("div",{className:"sup-account hidden",role:"menuitem",tabIndex:"-1"},a.default.createElement("h1",{className:"sup-account-used-info","data-l10n-id":"setup-account-usedInfo"}),a.default.createElement("p",{className:"sup-app-li","data-l10n-id":"app-calendar"},"Calendar")),y=function(e){var t,n;function y(t){var n;return u(d(n=e.call(this,t)||this),"element",void 0),u(d(n),"FOCUS_SELECTOR",".login-caldav-focus"),u(d(n),"handleLocalize",function(){n.forceUpdate()}),u(d(n),"updateSoftkey",function(e){var t=n.element.querySelector(n.FOCUS_SELECTOR+".focus #showPwd");r.a.register({left:"cancel",center:t?"select":"",right:e?"next":""},document)}),u(d(n),"focus",function(){n.updateSoftkey()}),u(d(n),"handleKeydown",function(e){var t=null;switch(e.key){case"Enter":e.stopPropagation(),e.preventDefault(),n.handlKeydownClick();break;case"ArrowUp":e.stopPropagation(),e.preventDefault(),t=n.findNext(-1);break;case"ArrowDown":e.stopPropagation(),e.preventDefault(),t=n.findNext(1);break;case"BrowserBack":case"Backspace":e.stopPropagation(),e.preventDefault(),n.historyBack(-1);break;case"SoftRight":e.stopPropagation(),e.preventDefault(),n.handleRightSoftkey();break;case"SoftLeft":e.stopPropagation(),e.preventDefault(),n.handleLeftSoftkey()}n.changeFocusItem(t),n.handleInputItem()}),u(d(n),"changeFocusItem",function(e){if(e){var t=n.element.querySelector(n.FOCUS_SELECTOR+".focus");t&&t.classList.remove("focus"),e.scrollIntoView(!1),e.classList.add("focus"),e.focus();var a=e.querySelector(".input-focusable");a&&a.focus()}}),n.handleKeydown=n.handleKeydown.bind(d(n)),n.handleUsername=n.handleUsername.bind(d(n)),n.handlePassword=n.handlePassword.bind(d(n)),n.handleUrl=n.handleUrl.bind(d(n)),n.handleInputItem=n.handleInputItem.bind(d(n)),n}n=e,(t=y).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var g=y.prototype;return g.componentDidMount=function(){var e,t=(e=regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.initAllEvents(),this.updateSoftkey(),(t=Array.from(this.element.querySelectorAll(this.FOCUS_SELECTOR)))[0].classList.add("focus"),t[0].focus(),(n=t[0].querySelector(".input-focusable"))&&n.focus();case 7:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(a,r){var l=e.apply(t,n);function s(e){c(l,a,r,s,o,"next",e)}function o(e){c(l,a,r,s,o,"throw",e)}s(void 0)})});return function(){return t.apply(this,arguments)}}(),g.componentWillUnmount=function(){this.removeAllEvents()},g.initAllEvents=function(){window.addEventListener("localized",this.handleLocalize),document.addEventListener("keydown",this.handleKeydown)},g.removeAllEvents=function(){window.removeEventListener("localized",this.handleLocalize),document.removeEventListener("keydown",this.handleKeydown)},g.historyBack=function(e){this.element.querySelector(".focus").focus(),l.a.go(e)},g.handlKeydownClick=function(){var e=this.element.querySelector(".focus");e&&e.click()},g.findNext=function(e){var t=Array.from(this.element.querySelectorAll(this.FOCUS_SELECTOR));if(!t.length)return null;var n=this.element.querySelector(this.FOCUS_SELECTOR+".focus")||t[0],a=-1;return t.some(function(r,l){return r===n&&(a=(l+t.length+e)%t.length,!0)}),-1===a?null:t[a]},g.handleShowPasswordClick=function(e){var t=e.target.querySelector("#showPwd");t&&(t.checked=!t.checked,this.password.type=t.checked?"text":"password")},g.handleUsername=function(e){this.handleInputItem(e)},g.handlePassword=function(e){this.handleInputItem(e)},g.handleUrl=function(e){this.handleInputItem(e)},g.handleInputItem=function(){var e=this.username.value&&this.username.value.length>0,t=this.password.value&&this.password.value.length>0,n=this.url.checkValidity()&&this.url.value.length>0;this.isInLogin()||this.updateSoftkey(e&&t&&n)},g.isInLogin=function(){return!!this.element.querySelector(".login-caldav-container.hidden")},g.handleLeftSoftkey=function(){Object(s.G)("left")&&(this.isInLogin()?(this.displayAccountLoginPanel(),this.handleInputItem(),window.isCancelLoginCaldav=!0):this.historyBack(-1))},g.handleRightSoftkey=function(){Object(s.G)("right")&&(this.isInLogin()?this.historyBack(-2):(this.displayLoginAccountPanel(),this.loginCaldavAccount()))},g.displayLoginItemPanel=function(){var e=this.element.querySelector(".login-caldav-container"),t=this.element.querySelector(".sync-account-body"),n=this.element.querySelector(".sup-account");e&&e.classList.add("hidden"),t&&t.classList.remove("hidden"),t.focus(),n&&n.classList.add("hidden"),this.updateSoftkey(!0)},g.displayLoginAccountPanel=function(){var e=this.element.querySelector(".login-caldav-container"),t=this.element.querySelector(".sync-account-body"),n=this.element.querySelector(".sup-account");e&&e.classList.add("hidden"),t&&t.classList.remove("hidden"),t.focus(),n&&n.classList.add("hidden");var a=this.element.querySelector(this.FOCUS_SELECTOR+".focus input");a&&a.blur(),r.a.register({left:"cancel",center:"",right:""},document)},g.displayLoginSuccPanel=function(){var e=this.element.querySelector(".login-caldav-container"),t=this.element.querySelector(".sync-account-body"),n=this.element.querySelector(".sup-account");e&&e.classList.add("hidden"),t&&t.classList.add("hidden"),n&&n.classList.remove("hidden"),n.focus(),r.a.register({left:"",center:"",right:"next"},document)},g.displayAccountLoginPanel=function(){var e=this.element.querySelector(".login-caldav-container"),t=this.element.querySelector(".sync-account-body"),n=this.element.querySelector(".sup-account");e&&e.classList.remove("hidden"),t&&t.classList.add("hidden"),n&&n.classList.add("hidden")},g.handleCaldavLoginErr=function(e){this.displayAccountLoginPanel(),this.password.value="",this.changeFocusItem(this.password.parentNode),this.handleInputItem();var t="";t=401===e?"error-unauthenticated":500===e?"error-internal-server-error":"error-unknown",Toaster.showToast({messageL10nId:t})},g.loginCaldavAccount=function(){var e=this,t=this.username.value,n=this.password.value,a=this.url.value;Object(o.c)({user:t,password:n,url:a},function(r,l){if(r)return console.error("login caldav account error, error: "+r),void(r?e.handleCaldavLoginErr(r):e.historyBack(-2));window.isCancelLoginCaldav?window.isCancelLoginCaldav=!1:(e.displayLoginSuccPanel(),window.displayAccount.push({value:t,checked:!0,authenticatorId:"caldav"}),Object(s.M)(window.displayAccount),window.calendarSync["caldav:"+t]=!0,Object(s.L)({user:t,password:n,url:a,calendarItems:l,authenticatorId:"caldav",syncSwitch:!0}))})},g.renderUsername=function(){var e=this;return a.default.createElement("li",{className:"username login-caldav-focus",tabIndex:"-1"},h,a.default.createElement("input",{"aria-labelledby":"username-title",className:"p-pri input-focusable",name:"username",maxlength:"100","x-inputmode":"latin-prose",dir:"auto",type:"text",ref:function(t){e.username=t},oninput:function(t){return e.handleUsername(t)}}))},g.renderPassword=function(){var e=this;return a.default.createElement("li",{id:"acc-password",className:"password login-caldav-focus",role:"listitem"},f,a.default.createElement("input",{"aria-labelledby":"modify-account-password",className:"p-pri input-focusable",name:"password",maxlength:"50",type:"password",id:"account-password",ref:function(t){e.password=t},oninput:function(t){return e.handlePassword(t)}}))},g.renderShowPassword=function(){var e=this;return a.default.createElement("li",{id:"showPwd-li",className:"show-password login-caldav-focus",tabIndex:"-1",onClick:function(t){return e.handleShowPasswordClick(t)}},p)},g.renderUrl=function(){var e=this;return a.default.createElement("li",{className:"url login-caldav-focus",tabIndex:"-1"},m,a.default.createElement("input",{"aria-labelledby":"url-title",className:"p-pri input-focusable",name:"username",maxlength:"100","x-inputmode":"latin-prose",dir:"auto",type:"text",pattern:"https?://.+",ref:function(t){e.url=t},oninput:function(t){return e.handleUrl(t)}}))},g.render=function(){var e=this;return a.default.createElement("div",{id:"login-caldav",className:"login-caldav",tabIndex:"-1",role:"heading","aria-labelledby":"login-caldav-view",ref:function(t){e.element=t}},a.default.createElement(i.a,{view:"login-caldav-view",headerStr:Object(s.a)("login-caldav-header")}),a.default.createElement("div",{className:"login-caldav-container"},this.renderUsername(),this.renderPassword(),this.renderShowPassword(),this.renderUrl()),v,w)},y}(a.default.Component)}}]);