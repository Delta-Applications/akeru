(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{633:function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return w});var a=n(0),r=n(21),l=n(163),s=n(2),i=n(19),c=n(95),d=n(51),o=n(26),u=n(599);n(601);function f(e,t,n,a,r,l,s){try{var i=e[l](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(a,r)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=a.default.createElement("span",{className:"icon","data-icon":"forward"}),h=a.default.createElement("span",{id:"eventreminder-title","data-l10n-id":"sync-calendar",role:"heading","aria-level":"2",className:"p-pri modify-event-reminder"}),g=a.default.createElement("span",{className:"settings-title-span","data-l10n-id":"advanced-settings-reminders"}),y=a.default.createElement("header",{"aria-level":"2",role:"heading",skin:"organic",className:"account-list-header",id:"account-list-header"},a.default.createElement("span",{"data-l10n-id":"account-header",className:"p-sec"})),E=a.default.createElement("header",{"aria-level":"2",role:"heading",skin:"organic",className:"account-list-header",id:"account-list-header"},a.default.createElement("span",{"data-l10n-id":"advanced-settings-personalization",className:"p-sec"})),N=a.default.createElement("header",{"aria-level":"2",role:"heading",skin:"organic",className:"account-list-header",id:"account-list-header"},a.default.createElement("span",{"data-l10n-id":"advanced-settings-reminders",className:"p-sec"})),S=a.default.createElement("span",{id:"eventreminder-title","data-l10n-id":"settings-events-reminder",role:"heading","aria-level":"2",className:"p-pri modify-event-reminder"}),b=a.default.createElement("span",{id:"eventreminder-title","data-l10n-id":"settings-all-day-events-reminder",role:"heading","aria-level":"2",className:"p-pri modify-event-reminder"}),w=function(e){var t,n;function w(t){var n;return v(m(n=e.call(this,t)||this),"DEFAULT_FREQUERCY","15"),v(m(n),"DEFAULT_REMINDER","-300"),v(m(n),"DEFAULT_ALLDAY_REMINDER","32400"),v(m(n),"frequencyNode",void 0),v(m(n),"reminderNode",void 0),v(m(n),"eventsReminderNode",void 0),v(m(n),"allDayEventsReminderNode",void 0),v(m(n),"logger",new c.a("SettingsView","trace")),v(m(n),"FOCUS_SELECTOR",".settings-view-focus"),v(m(n),"focusFirstItem",function(){var e=n.element.querySelector(n.FOCUS_SELECTOR+".focus");e&&e.classList.remove("focus");var t=n.element.querySelector(""+n.FOCUS_SELECTOR);t.classList.add("focus"),t.focus();var a=n.element.querySelector(".settings-container");a&&(a.scrollTop=0)}),v(m(n),"updateSoftkey",function(){r.a.register({left:"",center:"select",right:""},document)}),v(m(n),"focus",function(){n.updateSoftkey()}),v(m(n),"handleKeydown",function(e){var t=null;switch(e.key){case"Enter":e.stopPropagation(),e.preventDefault(),n.handlKeydownClick();break;case"ArrowUp":e.stopPropagation(),e.preventDefault(),t=n.findNext(-1);break;case"ArrowDown":e.stopPropagation(),e.preventDefault(),t=n.findNext(1);break;case"BrowserBack":case"Backspace":e.stopPropagation(),e.preventDefault(),d.a.go(-1);break;case"SoftRight":Object(i.c)()}n.changeFocusItem(t)}),v(m(n),"changeFocusItem",function(e){if(e){var t=n.element.querySelector(n.FOCUS_SELECTOR+".focus");t&&t.classList.remove("focus"),e.scrollIntoView(!1),e.classList.add("focus"),e.focus()}}),v(m(n),"handleLocalize",function(){n.forceUpdate()}),n.state={eventsSyncFrequency:n.DEFAULT_FREQUERCY,eventsReminder:n.DEFAULT_REMINDER,allDayEventsReminder:n.DEFAULT_ALLDAY_REMINDER,allRemoteAccounts:[]},n.handleKeydown=n.handleKeydown.bind(m(n)),n}n=e,(t=w).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var R=w.prototype;return R.componentDidMount=function(){var e,t=(e=regeneratorRuntime.mark(function e(){var t,n,a,r,i,c,d,o,u,f,m=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateSoftkey(),t=localStorage.getItem("cal-settings"),n=JSON.parse(t||"{}"),a=n.standardAlarm,r=n.alldayAlarm,i=n.syncFrequency,c=a,d=r,o=i,u=[],e.prev=8,e.next=11,l.a.managerGetAccounts();case 11:u=e.sent,u=Object(s.j)(u),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(8),u=[],console.error("managerGetAccounts failed err: "+e.t0);case 19:(f=JSON.parse(localStorage.getItem("caldav-accounts")))&&f.length>0&&f.forEach(function(e){u.push({accountId:e.user,authenticatorId:e.authenticatorId})}),this.setState({eventsSyncFrequency:o,eventsReminder:c,allDayEventsReminder:d,allRemoteAccounts:u},function(){m.focusFirstItem(),m.updateSoftkey()}),window.addEventListener("localized",this.handleLocalize),document.addEventListener("keydown",this.handleKeydown);case 24:case"end":return e.stop()}},e,this,[[8,15]])}),function(){var t=this,n=arguments;return new Promise(function(a,r){var l=e.apply(t,n);function s(e){f(l,a,r,s,i,"next",e)}function i(e){f(l,a,r,s,i,"throw",e)}s(void 0)})});return function(){return t.apply(this,arguments)}}(),R.componentDidUpdate=function(){this.element.querySelector(this.FOCUS_SELECTOR+".focus")||this.focusFirstItem(),this.updateSoftkey()},R.componentWillUnmount=function(){window.removeEventListener("localized",this.handleLocalize),document.removeEventListener("keydown",this.handleKeydown)},R.handlKeydownClick=function(){var e=this.element.querySelector(".focus"),t=this.element.querySelector(".focus select");e&&e.click(),t&&t.focus()},R.findNext=function(e){var t=Array.from(this.element.querySelectorAll(this.FOCUS_SELECTOR));if(!t.length)return null;var n=this.element.querySelector(this.FOCUS_SELECTOR+".focus")||t[0],a=-1;return t.some(function(r,l){return r===n&&(a=(l+t.length+e)%t.length,!0)}),-1===a?null:t[a]},R.handleChange=function(e,t){var n=e.target.value;0===t?(this.setState({eventsSyncFrequency:n}),o.a.changeSyncFrequency(n)):1===t?this.setState({eventsReminder:n}):2===t&&this.setState({allDayEventsReminder:n}),Object(s.O)("cal-settings",{standardAlarm:this.eventsReminderNode.value,alldayAlarm:this.allDayEventsReminderNode.value,syncFrequency:this.frequencyNode.value})},R.renderUpdateFrequencyInput=function(){var e=this,t=this.state.eventsSyncFrequency;return a.default.createElement("select",{id:"setting-sync-frequency","data-track-class":"sync",onChange:function(t){return e.handleChange(t,0)},ref:function(t){e.frequencyNode=t}},a.default.createElement("option",{"data-l10n-id":"sync-frequency-15min",selected:"15"===t,value:"15"}),a.default.createElement("option",{"data-l10n-id":"sync-frequency-30min",selected:"30"===t,value:"30"}),a.default.createElement("option",{"data-l10n-id":"sync-frequency-manual",selected:"null"===t,value:"null"}))},R.renderReminderInput=function(){var e=this,t=this.state.eventsReminder;return a.default.createElement("select",{id:"setting-events-reminder",name:Object(s.a)("event-repeat"),"data-track-class":"reminder",onChange:function(t){return e.handleChange(t,1)},ref:function(t){e.eventsReminderNode=t}},a.default.createElement("option",{value:"none","data-l10n-id":"none","data-l10n-args":"{}",selected:"none"===t}),a.default.createElement("option",{value:"0",selected:"0"===t,"data-l10n-id":"alarm-at-event-standard","data-l10n-args":"{}"}),a.default.createElement("option",{value:"-300",selected:"-300"===t,"data-l10n-id":"minutes-before","data-l10n-args":JSON.stringify({value:5})}),a.default.createElement("option",{value:"-900",selected:"-900"===t,"data-l10n-id":"minutes-before","data-l10n-args":JSON.stringify({value:15})}),a.default.createElement("option",{value:"-1800",selected:"-1800"===t,"data-l10n-id":"minutes-before","data-l10n-args":JSON.stringify({value:30})}),a.default.createElement("option",{value:"-3600",selected:"-3600"===t,"data-l10n-id":"hours-before","data-l10n-args":JSON.stringify({value:1})}),a.default.createElement("option",{value:"-7200",selected:"-7200"===t,"data-l10n-id":"hours-before","data-l10n-args":JSON.stringify({value:2})}),a.default.createElement("option",{value:"-86400",selected:"-86400"===t,"data-l10n-id":"days-before","data-l10n-args":JSON.stringify({value:1})}))},R.renderAllDayReminderInput=function(){var e=this,t=this.state.allDayEventsReminder;return a.default.createElement("select",{id:"setting-allday-events-reminder","data-track-class":"allday-reminder",name:Object(s.a)("event-repeat"),onChange:function(t){return e.handleChange(t,2)},ref:function(t){e.allDayEventsReminderNode=t}},a.default.createElement("option",{value:"none",selected:"none"===t,"data-l10n-id":"none","data-l10n-args":"{}"}),a.default.createElement("option",{value:"32400",selected:"32400"===t,"data-l10n-id":"alarm-at-event-allday","data-l10n-args":"{}"}),a.default.createElement("option",{value:"-54000",selected:"-54000"===t,"data-l10n-id":"days-before","data-l10n-args":JSON.stringify({value:1})}),a.default.createElement("option",{value:"-140400",selected:"-140400"===t,"data-l10n-id":"days-before","data-l10n-args":JSON.stringify({value:2})}),a.default.createElement("option",{value:"-572400",selected:"-572400"===t,"data-l10n-id":"weeks-before","data-l10n-args":JSON.stringify({value:1})}),a.default.createElement("option",{value:"-1177200",selected:"-1177200"===t,"data-l10n-id":"weeks-before","data-l10n-args":JSON.stringify({value:2})}))},R.renderAllAccounts=function(){for(var e=this.state.allRemoteAccounts,t=[],n=function(n){var r=e[n];t.push(a.default.createElement("ol",{key:n,className:"account-item settings-view-focus",tabindex:"-1",onClick:function(){d.a.push("/deleteAccount",{account:r})}},a.default.createElement("span",{className:"p-pri account-name"},r.accountId),p))},r=0;r<e.length;r++)n(r);return t},R.renderAccounts=function(){return a.default.createElement("li",{className:"settings-div-wrapper"},this.renderAllAccounts(),a.default.createElement("button",{className:"settings-button p-pri settings-view-focus",tabIndex:"-1",type:"button",onClick:function(){d.a.push("/addAccount")}},Object(s.a)("advanced-settings-add-account")))},R.renderUpdateFrequency=function(){return a.default.createElement("li",{role:"menuitem",className:"settings-view-focus",tabIndex:"-1"},h,a.default.createElement("span",{className:"button"},this.renderUpdateFrequencyInput()))},R.renderReminders=function(){return a.default.createElement("div",{className:"settings-div-wrapper"},g,this.renderReminderInput(),this.renderAllDayReminderInput())},R.render=function(){var e=this;return a.default.createElement("div",{id:"settings",className:"settings",tabIndex:"-1",ref:function(t){e.element=t},role:"heading","aria-labelledby":"settings-header"},a.default.createElement(u.a,{view:"settings-header",headerStr:Object(s.a)("advanced-settings-header")}),a.default.createElement("div",{className:"settings-container"},y,this.renderAllAccounts(),a.default.createElement("li",{className:"settings-div-wrapper",role:"menuitem"},a.default.createElement("button",{className:"settings-button p-pri settings-view-focus",tabIndex:"-1",type:"button",onClick:function(){d.a.push("/addAccount")}},Object(s.a)("advanced-settings-add-account"))),E,this.renderUpdateFrequency(),N,a.default.createElement("li",{role:"menuitem",className:"settings-view-focus",tabIndex:"-1"},S,a.default.createElement("span",{className:"button"},this.renderReminderInput())),a.default.createElement("li",{role:"menuitem",className:"settings-view-focus",tabIndex:"-1"},b,a.default.createElement("span",{className:"button"},this.renderAllDayReminderInput()))))},w}(a.default.Component)}}]);