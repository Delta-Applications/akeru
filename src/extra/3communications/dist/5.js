(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{34:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return s})),i.d(t,"e",(function(){return o})),i.d(t,"f",(function(){return l})),i.d(t,"a",(function(){return c})),i(3);const n=(e,t)=>{let i;return(...n)=>{const a=!i;return window.clearTimeout(i),i=window.setTimeout(()=>{i=null},e),a&&t(...n),i}},a=({callType:e,simNum:t})=>{let i="call";-1!==e.indexOf("rttCall")?i="call-rtt":-1!==e.indexOf("videoCall")&&(i="video-call");const n=(()=>{const{iccManager:e}=window.navigator.b2g;return e&&e.iccIds.length>1})()?t:"";return`${i}-${e.split("_")[0]}${n}`},r=e=>{const t=new Date(e);return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()},s=e=>{const{get:t}=window.api.l10n,i=(r(Date.now())-r(e))/1e3,n=Math.floor(i/86400),a=new Date(e),s=(new Date).getFullYear()===a.getFullYear(),o=navigator.language;return 0===n?t("today"):1===n?t("yesterday"):n<7&&n>1?a.toLocaleString(o,{weekday:"long"}):s?a.toLocaleString(o,{weekday:"short",month:"long",day:"numeric"}):a.toLocaleString(o,{weekday:"short",year:"numeric",month:"short",day:"numeric"})},o=()=>document.body.classList.contains("low-memory-device"),l=()=>DeviceCapabilityManager.get("device.parental-control").then(e=>!!e),c=()=>{document.hidden||navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({name:"clearNotices"})}},35:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return a})),i.d(t,"d",(function(){return r})),i.d(t,"c",(function(){return s}));const n=()=>!(!ContactsManager||!ContactsManager.findBlockedNumbers),a=e=>e?ContactsManager.addBlockedNumber(e):Promise.reject(new TypeError("Invalid number")),r=e=>e?ContactsManager.removeBlockedNumber(e):Promise.reject(new TypeError("Invalid number")),s=e=>{const t={filterValue:e,filterOption:ContactsManager.FilterOption.MATCH};return ContactsManager.findBlockedNumbers(t).then(e=>!(!e||!e.length))}},36:function(e,t,i){"use strict";var n=i(9);function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}t.a=new class extends n.a{constructor(){super(),a(this,"getSimCardIndex",()=>this.cardIndex),a(this,"getDefaultSimCardIndex",()=>{let e=this.cardIndex;return-1===e&&(e=0,this.hasOnlyOneSIMCardDetected()&&(e=this.isSIMCardAbsent(0)?1:0)),e}),a(this,"isSIMCardAbsent",e=>{const t=navigator.b2g.mobileConnections[e];if(!this.iccManager||!t)return!0;const i=this.iccManager.getIccById(t.iccId);return!i||i&&i.iccInfo&&null===i.iccInfo.iccid}),a(this,"hasOnlyOneSIMCardDetected",()=>this.isSIMCardAbsent(0)^this.isSIMCardAbsent(1)),this.iccManager=window.navigator.b2g.iccManager,this.multipleSIMs=this.iccManager&&this.iccManager.iccIds.length>1,this.cardIndex=-1,this.getCardIndex()}getCardIndex(){SettingsObserver.observe("ril.telephony.defaultServiceId",-1,e=>{this.cardIndex=e,this.emit("update")})}showSimIndicator(){return this.multipleSIMs&&this.cardIndex>=0}}},39:function(e,t,i){"use strict";i.r(t);var n=i(9),a=i(3),r=i(34),s=i(36),o=i(35),l={InvalidNumber:{header:"invalidNumberToDialTitle",content:"invalidNumberToDialMessage",translated:!1},NumberBlocked:{content:"numberBlockedMessage",translated:!1},NoNetwork:{header:"emergencyDialogTitle",content:"emergencyDialogBodyBadNumber",translated:!1},RadioNotAvailable:{header:"callAirplaneModeTitle",content:"callAirplaneModeMessage",translated:!1},DeviceNotAccepted:{header:"emergencyDialogTitle",content:"emergencyDialogBodyDeviceNotAccepted",translated:!1},Busy:{header:"numberIsBusyTitle",content:"numberIsBusyMessage",translated:!1},FDNBlocked:{header:"fdnIsActiveTitle",content:"fdnIsActiveMessage",containNumber:!0,translated:!1},FdnCheckFailure:{header:"fdnIsActiveTitle",content:"fdnIsActiveMessage",containNumber:!0,translated:!1},OtherConnectionInUse:{header:"otherConnectionInUseTitle",content:"otherConnectionInUseMessage",translated:!1},EmergencyCallOnly:{header:"emergency-call-only",content:"emergency-call-error",containNumber:!0,translated:!1},Default:{content:"CallFailed",translated:!1}};const{get:c}=window.api.l10n,d=1,h=4,{get:u}=window.api.l10n;t.default=class extends n.a{constructor(){super(),this.name="DialHelper",this.DEBUG=!1,this.isDialing=!1;const{telephony:e}=window.navigator.b2g;this.telephony=e,this.call=Object(r.b)(1e3,this.call.bind(this)),this.isRtt=!1,this.rttPref="always-visible-automatic",this.hasVideo=!1,SettingsObserver.observe("ril.rtt.enabled",this.isRtt,e=>{this.isRtt=e,this.emit("update")}),SettingsObserver.observe("ril.rtt.preferredSettings","always-visible-automatic",e=>{this.rttPref=e,this.emit("update")}),this.isParentalControl=!1,Object(r.f)().then(e=>{this.isParentalControl=e})}async dialVoice(e,t){return this.dial(e,{serviceId:t,isRtt:!1,isVideo:!1})}async dialRtt(e,t){return this.dial(e,{serviceId:t,isRtt:!0,isVideo:!1})}async dialVideo(e,t){return this.dial(e,{serviceId:t,isRtt:!1,isVideo:!0})}async dial(e,t={serviceId:0,isRtt:!1,isVideo:!1}){const{serviceId:i,isRtt:n,isVideo:a}=t;if(this.isDialing)return;this.debug("Trying to dial: "+JSON.stringify({number:e,...t}));const r=()=>{this.isDialing=!1,document.removeEventListener("visibilitychange",r)};document.addEventListener("visibilitychange",r),this.isDialing=!0;const s=this.getConnection(i),o=this.isEmergencyOnly(s);let l;try{n?(this.debug("Dialing an RTT call..."),l=this.telephony.dial(e,d,!0,i)):a?(this.debug("Dialing a video call..."),l=this.telephony.dial(e,h,!1,i)):(this.debug("Dialing a voice call..."),l=this.telephony.dial(e,d,!1,i)),l.then(()=>{}).catch(t=>{this.showErrorDialog(t,e,o)})}catch(e){throw this.isDialing=!1,e}}async chooseSim(){let e=0;try{e=await a.a.request("chooseSim","call")}catch(e){throw e}return this.debug(`The SIM card ${e} is selected.`),e}async isEmergencyNumber(e,t=0){let i;try{i=await this.telephony.getEccList(t)}catch(e){throw e}return(i=i.split(",")).includes(e)}async isNumberAllowed(e,t,i){if(await this.isEmergencyNumber(e,i))return!0;const n=await Object(o.c)(e);return"true"===t&&!n}async getVilte(){try{this.hasVideo=await DeviceCapabilityManager.get("device.vilte")}catch(e){throw e}}getConnection(e){const{mobileConnections:t}=window.navigator.b2g;return t&&t[e]}isEmergencyOnly(e){return!(e.imsHandler&&e.imsHandler.capability)&&e.voice.emergencyCallsOnly}hasNetwork(e){const t=e&&e.voice,i=this.isEmergencyOnly(e),n=t&&(i||e.iccId);return this.debug("hasNetwork: "+n),n}showErrorDialog(e,t="",i){this.isDialing=!1;let n=e;"BadNumber"!==n&&"ServiceNotAvailable"!==n||(n=i?"NoNetwork":"EmergencyCallOnly");const a=((e,t)=>({type:"alert",noClose:!1,...((e,t)=>e.containNumber?{header:c(e.header,{number:t}),content:c(e.content,{number:t}),containNumber:!0,translated:!0}:e)(e,t)}))(l[n]||l.Default,t),r=new CustomEvent("showDialDialog",{detail:{data:a}});window.dispatchEvent(r)}async call(e,t){const i=e.replace(/(\s|-|\.|\(|\))/g,"");if(!this.isValid(i))return void this.showErrorDialog("InvalidNumber");if(!this.telephony)return void this.showErrorDialog("DeviceNotAccepted",i);let n=s.a.getSimCardIndex();if(-1===n)try{n=await this.chooseSim()}catch(e){throw e}if(this.isParentalControl&&!await this.isNumberAllowed(i,t,n))return void this.showErrorDialog("NumberBlocked");const a=this.getConnection(n);if(!this.hasNetwork(a))return void this.showErrorDialog("NoNetwork",i);let r=[];if((r=this.getCallOptions(i,n)).length<=0)throw new Error("No call options found.");r.length>=2?this.showCallMenu(r):r[0].callback()}showCallMenu(e){const t=new CustomEvent("showDialOptionMenu",{detail:{data:{header:"select",options:e}}});window.dispatchEvent(t)}getCallOptions(e,t){const i={label:u("call"),callback:()=>{this.dialVoice(e,t)}},n={label:u("rttCall"),callback:()=>{this.dialRtt(e,t)}},a={label:u("videoCall"),callback:()=>{this.dialVideo(e,t)}};let r=[];if(this.isRtt)switch(this.rttPref){case"always-visible-manual":r=r.concat([i,n]);break;case"always-visible-automatic":r=r.concat([n]);break;case"visible-during-calls":default:r=r.concat([i])}else r=r.concat([i]);return!this.hasVideo||this.isRtt&&"always-visible-automatic"===this.rttPref||(r=r.concat(a)),r}isValid(e){return/^(?!,)([0-9#+*,]){1,50}$/.test(e)}dialForcely(e){let t=s.a.getDefaultSimCardIndex();this.dialVoice(e,t)}showRttCall(){return this.isRtt&&"always-visible-automatic"===this.rttPref}}}}]);