define(["require","dsds_settings"],function(e){var t=e("dsds_settings"),n=function(e,n){function i(){function i(e){var t=o.bind(null,e),n=u.getIccById(e);if(n){n.addEventListener("cardstatechange",t);var i=s(e);i&&(i.addEventListener("datachange",t),i.addEventListener("radiostatechange",t))}}function a(){if(l.active||h){h=l.active?d[l.active.serviceId].iccId:null;for(var e=d.length,t=0;e>t;t++){var n=d[t];n.iccId&&o(n.iccId)}}}if(d=e.navigator.mozMobileConnections,c&&d&&u&&l&&1!==t.getNumberOfIccSlots()){f.forEach(function(e){var t=n.getElementById(e);p[f.indexOf(e)]=t.querySelector("small")}),f.forEach(function(e){var i=n.getElementById(e),o=i.querySelector("a");o.addEventListener("click",function(){t.setIccCardIndexForCallSettings(f.indexOf(e))})});for(var m=d.length,g=0;m>g;g++){var v=d[g];v.iccId?(o(v.iccId),i(v.iccId)):r(f[g],!0)}u.addEventListener("iccdetected",function(e){var t=e.iccId;o(t),i(t)}),u.addEventListener("iccundetected",function(e){var t=e.iccId,n=o.bind(null,t),i=s(t);i&&(i.removeEventListener("datachange",n),i.removeEventListener("radiostatechange",n))}),a(),l.addEventListener("callschanged",a)}}function o(e){var t=a(e),n=p[t];n.style.fontStyle="italic";var i=s(e);if(!i)return n.removeAttribute("data-l10n-id"),n.textContent="",r(f[t],!0),void 0;var o=u.getIccById(e);if(!o)return n.removeAttribute("data-l10n-id"),n.textContent="",r(f[t],!0),void 0;if("enabled"!==i.radioState)return n.setAttribute("data-l10n-id",_getCardDesription("null")),r(f[t],!0),void 0;"enabled"===i.radioState&&(n.removeAttribute("data-l10n-id"),n.textContent="",r(f[t],!1));var c=o.cardState;return"ready"!==c?(n.setAttribute("data-l10n-id",_getCardDesription(c||"null")),r(f[t],!0),void 0):(n.style.fontStyle="normal",_getOperatorName(i,n),r(f[t],h&&h!==e?!0:!1),void 0)}function r(e,t){var i=n.getElementById(e);t?(i.setAttribute("aria-disabled",!0),i.classList.add("none-select")):(i.removeAttribute("aria-disabled"),i.classList.remove("none-select"))}function a(e){for(var t=0;t<d.length;t++)if(d[t].iccId===e)return t;return-1}function s(e){for(var t=0;t<d.length;t++)if(d[t].iccId===e)return d[t];return null}var c=e.navigator.mozSettings,u=e.navigator.mozIccManager,d=null,l=e.navigator.mozTelephony,f=["menuItem-call-sim1","menuItem-call-sim2"],p=[],h=null;return{init:i}}(this,document);return n});