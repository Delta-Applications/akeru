define(["require","modules/settings_panel","modules/settings_service"],function(e){var t=e("modules/settings_panel"),n=e("modules/settings_service");return function(){var e,i;return t({onInit:function(t){e={panel:t,updateNameInput:t.querySelector("#update-simcard-name-input")},i={items:[{name:"Cancel",l10nId:"cancel",priority:1,method:function(){n.navigate("simcard-name")}},{name:"Save",l10nId:"save",priority:3,method:this._saveAndBack}]}},onBeforeShow:function(){SettingsSoftkey.init(i),SettingsSoftkey.show(),this._getSimcardInfo(),window.addEventListener("keydown",this._handleCSK)},onShow:function(){e.updateNameInput.focus()},onBeforeHide:function(){window.removeEventListener("keydown",this._handleCSK)},_getSimcardInfo:function(){var t=navigator.mozSettings.createLock().get("custom.simcards.name");t.onsuccess=function(){var n=navigator.mozMobileConnections[DsdsSettings.getIccCardIndexForCellAndDataSettings()],i=n.iccId,o=t.result["custom.simcards.name"];if(o&&i&&o[i])e.updateNameInput.value=o[i];else{var r=navigator.mozIccManager,a=r.getIccById(i);if(a){var s=MobileOperator.userFacingInfo(n);e.updateNameInput.value=s.operator?s.operator:navigator.mozL10n.get("no-operator")}}var c=e.updateNameInput.value.length;e.updateNameInput.setSelectionRange(c,c)}},_saveAndBack:function(){DsdsSettings.getIccCardIndexForCellAndDataSettings();var t=e.updateNameInput.value;t=t.replace(/^\s+|\s+$/g,"");var i={},o=navigator.mozSettings.createLock().get("custom.simcards.name");o.onsuccess=function(){var e=navigator.mozMobileConnections[DsdsSettings.getIccCardIndexForCellAndDataSettings()],r=e.iccId;i=o.result["custom.simcards.name"]||{},t?(i[r]=t,navigator.mozSettings.createLock().set({"custom.simcards.name":i}),n.navigate("simcard-name")):(delete i[r],navigator.mozSettings.createLock().set({"custom.simcards.name":i}),n.navigate("simcard-name"))}},_handleCSK:function(t){("Accept"===t.key||"Enter"===t.key)&&e.panel.querySelector(".focus input").focus()}})}});