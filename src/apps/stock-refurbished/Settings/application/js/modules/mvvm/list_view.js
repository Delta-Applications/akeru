define(["require","modules/mvvm/observable_array"],function(t){var e=new WeakMap,n=t("modules/mvvm/observable_array"),i=function(t,i,o){function r(t){var e=d.get(t);if(e&&"object"==typeof e){var n=d.get(e);n&&(n.forEach(function(t){e.unobserve(t)}),d.delete(e),d.delete(t))}}function a(t,e){var n=d.get(t)||[];d.has(t)&&(n=d.get(t)),n=Object.keys(e).map(function(n){return t.observe(n,e[n]),e[n](),e[n]}),d.set(t,n)}var s=null,c=t,u=o,l=!0,d=new WeakMap,f={observeAndCall:a},p=function(t){if(l){var e=t.data;switch(t.type){case"insert":h(e.index,e.items);break;case"remove":g(e.index,e.count);break;case"replace":m(e.index,e.newValue);break;case"reset":v(e.items||[])}}},h=function(t,e){if(!(e.length<=0)){for(var n=c.children[t],i=e.length-1;i>=0;i--){var o=u(e[i],void 0,f);d.set(o,e[i]),c.insertBefore(o,n),n=o}var r=document.querySelectorAll(".focus");if(r.length>0)window.dispatchEvent(new CustomEvent("refresh"));else{var a=new CustomEvent("panelready",{detail:{current:Settings.currentPanel}});window.dispatchEvent(a)}}},g=function(t,e){if(0!==e)if(e>=c.childElementCount)for(;c.firstElementChild;)r(c.firstElementChild),c.removeChild(c.firstElementChild);else for(var n=c.children[t],i=0;e>i&&n;i++){var o=n.nextElementSibling;r(n),c.removeChild(n),n=o}},m=function(t,e){var n=c.children[t];if(n){r(n);var i=u(e,n,f);d.set(n,e),i!==n&&(c.insertBefore(i,n),c.removeChild(n))}},v=function(t){var e=t.length,n=c.childElementCount;if(0===e)g(0,n);else if(n>=e)t.forEach(function(t,e){m(e,t)}),g(e,n-e);else{var i=t.slice(0,n),o=t.slice(n);i.forEach(function(t,e){m(e,t)}),h(n,o)}},y=function(){l&&v(s.array)},_={set:function(t){return s&&s.unobserve(p),t?(Array.isArray(t)&&(t=n(t)),s=t,s.observe("insert",p),s.observe("remove",p),s.observe("replace",p),s.observe("reset",p),this.enabled&&v(s.array),void 0):(s&&(g(0,s.length),s=null),void 0)},destroy:function(){s&&s.unobserve(p),g(0,s.length),e.delete(c),c=null,s=null,u=null,l=!1},get element(){return c},set enabled(t){l!==t&&(l=t,y())},get enabled(){return l}};return e.has(c)&&e.get(c).destroy(),e.set(c,_),c.innerHTML="",_.set(i),_};return i});