define(["require","shared/wifi_helper"],function(e){var t=e("shared/wifi_helper"),n=t.getWifiManager(),i=Settings.mozSettings,o=n&&n.connection&&n.connection.network,r={_wifiEnabledListeners:[],_wifiDisabledListeners:[],_wifiStatusChangeListeners:[],_wifiHasInternetListeners:[],_wifiCaptiveListeners:[],_wifiStatusTextChangeListeners:[],_wifiConnectionInfoUpdateListeners:[],_wifiWrongPasswordListeners:[],_wifiConnectingFailedListeners:[],_wifiObtainingIPFailedListeners:[],_wifiStatusText:{id:null},_macAddress:"",_init:function(){n&&(this._bindEvents(),this._updateWifi())},_bindEvents:function(){var e=this,t=this._updateWifi.bind(this),i=this._updateNetworkStatus.bind(this);this._wifiEnabledListeners.push(t,i),this._wifiDisabledListeners.push(t),this._wifiStatusChangeListeners.push(t),n&&(n.onenabled=function(t){e._wifiEnabled(t),e._wifiStatusTextChange()},n.ondisabled=function(t){e._wifiDisabled(t),e._wifiStatusTextChange()},n.onstatuschange=function(t){e._updateNetworkStatus(t),e._wifiStatusChange.call(e,t),e._wifiStatusTextChange()},n.onwifihasinternet=function(t){e._wifiHasInternetChange(t)},n.oncaptiveportallogin=function(t){e._wifiCaptiveChange(t)},n.onconnectioninfoupdate=e._wifiConnectionInfoUpdate.bind(e))},_updateWifi:function(e){var t=this;n&&(!this._macAddress&&i&&SettingsDBCache.getSettings(function(e){t._macAddress=e["deviceinfo.mac"]}),n.enabled&&this._storeMacAddress(),this._updateWifiStatusText(e))},_updateWifiStatusText:function(e){if(n.enabled){var t=e&&e.network?e.network:n.connection.network,i=e?e.status:n.connection.status,o=t?{ssid:t.ssid}:null;this._wifiStatusText={id:"fullStatus-"+i,args:o}}else this._wifiStatusText={id:"disabled"}},_updateNetworkStatus:function(e){if(o&&(!e||!e.network||o.ssid==e.network.ssid)){var t=e?e.status:n.connection.status;switch(t){case"dhcpfailed":this._wifiObtainingIPFailed();break;case"authenticationfailed":this._wifiWrongPassword(),o.password=null;break;case"associationreject":this._wifiConnectingFailed()}}},_wifiEnabled:function(e){this._wifiEnabledListeners.forEach(function(t){t(e)})},_wifiDisabled:function(e){this._wifiDisabledListeners.forEach(function(t){t(e)})},_wifiStatusChange:function(e){this._wifiStatusChangeListeners.forEach(function(t){t(e)})},_wifiHasInternetChange:function(e){this._wifiHasInternetListeners.forEach(function(t){t(e)})},_wifiCaptiveChange:function(e){this._wifiCaptiveListeners.forEach(function(t){t(e)})},_wifiStatusTextChange:function(){this._wifiStatusTextChangeListeners.forEach(function(e){e()})},_wifiWrongPassword:function(){this._wifiWrongPasswordListeners.forEach(function(e){e()})},_wifiConnectingFailed:function(){this._wifiConnectingFailedListeners.forEach(function(e){e()})},_wifiObtainingIPFailed:function(){this._wifiObtainingIPFailedListeners.forEach(function(e){e()})},_wifiConnectionInfoUpdate:function(e){this._wifiConnectionInfoUpdateListeners.forEach(function(t){t(e)})},_storeMacAddress:function(){n&&i&&n.macAddress&&n.macAddress!==this._macAddress&&"undefined"!==n.macAddress&&(this._macAddress=n.macAddress,i.createLock().set({"deviceinfo.mac":this._macAddress}))},_removeEventListener:function(e,t){var n=e.indexOf(t);n>=0&&e.splice(n,1)},associateNetwork:function(e,t){t=t||function(){};var i=n.associate(e),r=function(){i.error||(o=e),t(i.error)};i.onsuccess=r,i.onerror=r},forgetNetwork:function(e,t){t=t||function(){};var i=n.forget(e),r=function(){i.error||(o=null),t(i.error)};i.onsuccess=r,i.onerror=r}};return r._init(),{addEventListener:function(e,t){"wifiEnabled"===e?r._wifiEnabledListeners.push(t):"wifiDisabled"===e?r._wifiDisabledListeners.push(t):"wifiStatusChange"===e?r._wifiStatusChangeListeners.push(t):"wifiHasInternet"===e?r._wifiHasInternetListeners.push(t):"wifiCaptive"===e?r._wifiCaptiveListeners.push(t):"wifiStatusTextChange"===e?r._wifiStatusTextChangeListeners.push(t):"wifiWrongPassword"===e?r._wifiWrongPasswordListeners.push(t):"wifiConnectingFailed"===e?r._wifiConnectingFailedListeners.push(t):"wifiObtainingIPFailed"===e?r._wifiObtainingIPFailedListeners.push(t):"wifiConnectionInfoUpdate"===e&&r._wifiConnectionInfoUpdateListeners.push(t)},removeEventListener:function(e,t){"wifiEnabled"===e?r._removeEventListener(r._wifiEnabledListeners,t):"wifiDisabled"===e?r._removeEventListener(r._wifiDisabledListeners,t):"wifiStatusChange"===e?r._removeEventListener(r._wifiStatusChangeListeners,t):"wifiHasInternet"===e?r._removeEventListener(r._wifiHasInternetListeners,t):"wifiCaptive"===e?r._removeEventListener(r._wifiCaptiveListeners,t):"wifiStatusTextChange"===e?r._removeEventListener(r._wifiStatusTextChangeListeners,t):"wifiWrongPassword"===e?r._removeEventListener(r._wifiWrongPasswordListeners,t):"wifiConnectingFailed"===e?r._removeEventListener(r._wifiConnectingFailedListeners,t):"wifiObtainingIPFailed"===e?r._removeEventListener(r._wifiObtainingIPFailedListeners,t):"wifiConnectionInfoUpdate"===e&&r._removeEventListener(r._wifiConnectionInfoUpdateListeners,t)},get wifiStatusText(){return r._wifiStatusText},get currentNetwork(){return o},forgetNetwork:r.forgetNetwork,associateNetwork:r.associateNetwork}});