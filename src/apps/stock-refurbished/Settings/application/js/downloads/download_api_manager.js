!function(e){function t(e){for(var t=0;t<e.length;t++)n(e[t])}function n(e){d[a(e)]=e}function i(e){delete d[e]}function o(e){var t={added:"added"};return t[e]||"unknown"}function r(e){var t=DownloadStore.get(e.id);t.onsuccess=function(t){for(var r=Object.keys(d),a=t.target.result,s=null,c=0;c<r.length;c++){var l=d[r[c]];if(l.storageName==a.storageName&&l.storagePath==a.storagePath){s=l;break}}var f={type:o(e.operation),download:a};s&&(f.downloadApiId=s.id,i(s.id),n(a)),u(f)},t.onerror=function(t){console.error("Failed to get download with id = ",e.id," -- ",t)}}function a(e){return DownloadFormatter.getUUID(e)}function s(e,t,n){function o(){var e=DownloadHelper.remove(a);e.onsuccess=function(){i(r),t()},e.onerror=function(){DownloadHelper.handlerError(e.error,a),n(e.error.code)}}var r=e.id,a=d[r];if(e.force)o();else{var s=DownloadUI.show(DownloadUI.TYPE.DELETE,a);s.onconfirm=function(){o()},s.oncancel=n}}function c(e){switch(e.operation){case"added":window.setTimeout(function(){r(e)},0)}}function u(e){l&&l(e)}var d={},l=null,f="finalized",p="succeeded",h={_initialized:!1,init:function(){if(!this._initialized){var e=DownloadStore.addListener(c);e.onsuccess=function(){this._initialized=!0}.bind(this),e.onerror=function(e){console.error("Failed to initialize DownloadApiManager properly.",e)}}},getDownloads:function(e,n,i){var o=navigator.mozDownloadManager.getDownloads();o.then(function(n){function o(e){return e.state!==f&&e.state!==p}var r=n.filter(o),a=DownloadStore.getAll();a.onsuccess=function(n){var o=n.target.result,a=r.concat(o);console.log("------downloads-----zdx add for test---",a);for(var s=a.length,c=0;s>c;c++)if("downloads/picturetest"===a[c].storagePath){var u=a[c].storagePath+".jpg";a[c].storagePath=u,u=a[c].url+".jpg",a[c].url=u,u=a[c].path+".jpg",a[c].path=u,a[c].contentType="image/jpeg"}else if("downloads/htmltest"===a[c].storagePath){var u=a[c].storagePath+".html";a[c].storagePath=u,u=a[c].url+".html",a[c].url=u,u=a[c].path+".html",a[c].path=u,a[c].contentType="image/html"}a.sort(function(e,t){try{return t.startTime.getTime()-e.startTime.getTime()}catch(n){return!0}}),t(a),e(a,i)},a.onerror=function(){console.warn("DATASTORE FAILED"),t(r),e(r,i)}}.bind(this),n)},setOnDownloadHandler:function(e){function t(t){var i=t.download;n(i),"function"==typeof e&&e(i)}navigator.mozDownloadManager.ondownloadstart=t},deleteDownloads:function(e,t,n,i){if(null==e)return"function"==typeof n&&n(null,"Download items not defined or null"),void 0;if(0===e.length)return"function"==typeof i&&i(),void 0;var o=e.pop(),r=this;s(o,function(){t&&t(o.id),r.deleteDownloads(e,t,n,i)},function(a){n&&n(o.id,a),r.deleteDownloads(e,t,n,i)})},getDownload:function(e){return d[e]||null},updateDownload:function(e){n(e)},setListener:function(e){l=e}};e.DownloadApiManager=h}(this);