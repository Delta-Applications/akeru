var OggMetadata=function(){function e(){}function t(e,t){return n(e),r(e,t)}function n(e){var t=i(e);if(1!==t.segment_table.length)throw new Error("ogg identification header expected as only packet of first page");e.advance(t.segment_table[0])}function r(e,t){var n=i(e),r=function(e,t){return e+t},o=Array.reduce(n.segment_table,r,0);return new Promise(function(n,r){e.getMore(e.index,o,function(e,i){if(i)return r(i),void 0;try{var o=e.readByte(),s=!1;switch(o){case 3:s="vorbis"===e.readASCIIText(6),t.tag_format="vorbis";break;case 79:s="pusTags"===e.readASCIIText(7),t.tag_format="opus"}if(!s)return r("malformed ogg comment packet"),void 0;a(e,t),LazyLoader.load("js/metadata/vorbis_picture.js",function(){VorbisPictureComment.parsePictureComment(t).then(n)})}catch(u){r(u)}})})}function i(e){var t=e.readASCIIText(4);if("OggS"!==t)throw new Error("malformed ogg page header");e.advance(22);var n=e.readUnsignedByte(),r=e.readUnsignedByteArray(n);return{segment_table:r}}function a(t,n){var r=t.readUnsignedInt(!0);t.advance(r);for(var i=t.readUnsignedInt(!0),a={},s=0;i>s;s++)try{var u=o(t);u&&("picture"!==u.field||a.hasOwnProperty(u.field)?a.hasOwnProperty(u.field)?n[u.field]+=" / "+u.value:(n[u.field]=u.value,a[u.field]=!0):(n[u.field]=u.value,a[u.field]=!0))}catch(c){if(c instanceof e)return;console.warn("Error parsing ogg metadata frame",c)}}function o(t){if(t.remaining()<4)throw new e;var n=t.readUnsignedInt(!0);if(n>t.remaining())throw new e;var r=t.readUTF8Text(n),i=r.indexOf("=");if(-1===i)throw new Error("missing delimiter in comment");var a=r.substring(0,i).toLowerCase().replace(" ",""),o=u[a];if(o){var c=r.substring(i+1);return-1!==s.indexOf(o)&&(c=parseInt(c,10)),{field:o,value:c}}}var s=["tracknum","trackcount","discnum","disccount"],u={title:"title",artist:"artist",album:"album",tracknumber:"tracknum",tracktotal:"trackcount",discnumber:"discnum",disctotal:"disccount",metadata_block_picture:"picture"};return{parse:t}}();