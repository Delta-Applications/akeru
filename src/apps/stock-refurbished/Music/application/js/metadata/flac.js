var FLACMetadata=function(){function e(e,n){return e.seek(4),new Promise(function(i){function o(e){return e?(4===e.block_type?(r(e.view,n),a=!0):6===e.block_type&&(LazyLoader.load("js/metadata/vorbis_picture.js",function(){n.picture=VorbisPictureComment.readPicFrame(e.view),n.picture.start+=e.view.viewOffset,n.picture.end+=e.view.viewOffset}),s=!0),!a||!s):(i(n),!1)}n.tag_format="flac";var a=!1,s=!1;t(e,o)})}function t(e,r){n(e).then(function(e){!r(e)||e.last?r(null):(e.view.advance(e.length-e.view.index),t(e.view,r))}).catch(function(e){console.error("Error finding FLAC metadata:",e),r(null)})}function n(e){return new Promise(function(t,n){var r=e.readUnsignedByte(),i=128===(128&r),o=127&r,a=e.readUint24(!1);e.getMore(e.viewOffset+e.index,a+4,function(e,r){return r?(n(r),void 0):(t({last:i,block_type:o,length:a,view:e}),void 0)})})}function r(e,t){var n=e.readUnsignedInt(!0);e.advance(n);for(var r=e.readUnsignedInt(!0),o={},a=0;r>a;a++)try{var s=i(e);s&&(o.hasOwnProperty(s.field)?t[s.field]+=" / "+s.value:(t[s.field]=s.value,o[s.field]=!0))}catch(u){console.warn("Error parsing ogg metadata frame",u)}return t}function i(e){var t=e.readUnsignedInt(!0),n=e.readUTF8Text(t),r=n.indexOf("=");if(-1===r)throw new Error("missing delimiter in comment");var i=n.substring(0,r).toLowerCase().replace(" ",""),s=a[i];if(s){var u=n.substring(r+1);return-1!==o.indexOf(s)&&(u=parseInt(u,10)),{field:s,value:u}}return null}var o=["tracknum","trackcount","discnum","disccount"],a={title:"title",artist:"artist",album:"album",tracknumber:"tracknum",tracktotal:"trackcount",discnumber:"discnum",disctotal:"disccount"};return{parse:e}}();