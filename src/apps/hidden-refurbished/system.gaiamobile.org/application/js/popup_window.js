'use strict';(function(exports){var _=navigator.mozL10n.get;var PopupWindow=function(configs){if(configs&&configs.rearWindow){this.containerElement=configs.rearWindow.element;}
configs.chrome={bar:true};AppWindow.call(this,configs);if(!this.rearWindow){return;}
this.themeColor=this.rearWindow.themeColor;if(this.rearWindow.appChrome){this.element.classList.toggle('light',this.rearWindow.appChrome.useLightTheming());this.statusbar.titleBar.style.backgroundColor=this.rearWindow.appChrome.element.style.backgroundColor;}
this.browser.element.setAttribute('mozallowfullscreen','true');window.addEventListener('fullscreenchange',this);};PopupWindow.prototype=Object.create(AppWindow.prototype);PopupWindow.REGISTERED_EVENTS=['mozbrowserclose','mozbrowsererror','mozbrowservisibilitychange','mozbrowserloadend','mozbrowseractivitydone','mozbrowserloadstart','mozbrowsertitlechange','mozbrowserlocationchange','mozbrowsericonchange'];PopupWindow.SUB_COMPONENTS={'transitionController':window.AppTransitionController,'modalDialog':window.AppModalDialog,'valueSelector':window.ValueSelector,'authDialog':window.AppAuthenticationDialog,'contextmenu':window.BrowserContextMenu,'childWindowFactory':window.ChildWindowFactory,'statusbar':window.AppStatusbar};PopupWindow.prototype.eventPrefix='popup';PopupWindow.prototype.openAnimation='slide-from-bottom';PopupWindow.prototype.closeAnimation='slide-to-bottom';PopupWindow.prototype.CLASS_LIST='appWindow popupWindow';PopupWindow.prototype._DEBUG=false;PopupWindow.prototype.CLASS_NAME='PopupWindow';PopupWindow.prototype.requestOpen=function(){this.open();};PopupWindow.prototype.requestClose=function(){this.close();};PopupWindow.prototype._registerEvents=function(){AppWindow.prototype._registerEvents.call(this);this.browser.element.addEventListener('focus',this);this.browser.element.addEventListener('keydown',this);this.element.addEventListener('_scrollerModeChanged',this);};PopupWindow.prototype._unregisterEvents=function(){this.browser.element.removeEventListener('focus',this);this.browser.element.removeEventListener('keydown',this);this.element.removeEventListener('_scrollerModeChanged',this);window.removeEventListener('mozfullscreenchange',this);};PopupWindow.prototype._handle_focus=function(evt){AppWindow.prototype._handle__focus.call(this);if(evt.target===this.browser.element){this.setSoftkey();}};PopupWindow.prototype._handle_keydown=function(evt){this.handleKey(evt);}
PopupWindow.prototype.destroy=function(){this._unregisterEvents();AppWindow.prototype.destroy.call(this);}
PopupWindow.prototype._handle__scrollerModeChanged=function(evt){if(evt.target===this.element){this.setSoftkey();}};PopupWindow.prototype._handle_fullscreenchange=function(){if(document.activeElement===this.browser.element){this.setSoftkey();}}
PopupWindow.prototype.setSoftkey=function(){let centerIcon=getBrowserProperty(this.browser.element,'touchPanningSimulationEnabled')?'icon=browser-softkey-cursor':'select';let lskText=document.mozFullScreen?'exit':'cancel';let rskText=Service.query('hasVolumeKey')?'':'volume';Service.request('SoftKeyStore:register',{left:lskText,center:centerIcon,right:rskText},this.browser.element);};PopupWindow.prototype.handleKey=function(evt){switch(evt.key){case'SoftLeft':if(document.mozFullScreen){document.mozCancelFullScreen();}else{if(!Service.query('InputWindowManager.isActivated')){this.kill();}}
break;case'SoftRight':if(document.activeElement===this.browser.element){if(!Service.query('hasVolumeKey')){this.requestVolume();}}
break;case'1':case'w':this.browserNavigationWidgets.zoom('out');break;case'3':case'r':this.browserNavigationWidgets.zoom('in');break;case'2':case'e':this.browserNavigationWidgets.setNavigationMode('toggle');break;case'5':this.browserNavigationWidgets.scroll('top');break;case'8':this.browserNavigationWidgets.scroll('down');break;}};PopupWindow.prototype._handle__enter=function(evt){this.browserNavigationWidgets.setNavigationMode('spatial');};PopupWindow.prototype.requestVolume=function(){if(navigator.volumeManager){navigator.volumeManager.requestShow();}};exports.PopupWindow=PopupWindow;})(window);