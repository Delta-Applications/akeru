'use strict';(function(exports){var Core=function(){};Core.SUB_MODULES=['HierarchyManager','AirplaneMode','NotificationsSystemMessage','SuplHandler','AudioChannelService','SystemWindow','PaymentManager'];Core.SERVICES=['getAPI'];Core.EVENTS=['largetextenabledchanged'];BaseModule.create(Core,{name:'Core',REGISTRY:{'mozSettings':'SettingsCore','mozBluetooth':'BluetoothCore','mozMobileConnections':'MobileConnectionCore'},getAPI:function(api){for(var key in this.REGISTRY){if(api===BaseModule.lowerCapital(key.replace('moz',''))){return navigator[key];}}
return false;},_start:function(){for(var api in this.REGISTRY){this.debug('Detecting API: '+api+' and corresponding module: '+this.REGISTRY[api]);if(navigator[api]){this.debug('API: '+api+' found, starting the handler.');this.startAPIHandler(api,this.REGISTRY[api]);}else{this.debug('API: '+api+' not found, skpping the handler.');}}
this._handle_largetextenabledchanged();this.bc=new BroadcastChannel('ExternalScreen');this.bc.addEventListener('message',this._handle_message.bind(this));window.focus();},_handle_largetextenabledchanged:function(){document.body.classList.toggle('large-text',navigator.largeTextEnabled);},_handle_message:function(evt){window.focus();},startAPIHandler:function(api,handler){return new Promise(function(resolve,reject){BaseModule.lazyLoad([handler]).then(function(){var moduleName=BaseModule.lowerCapital(handler);if(window[handler]&&typeof(window[handler])==='function'){this[moduleName]=new window[handler](navigator[api],this);}else{this[moduleName]=BaseModule.instantiate(handler,navigator[api],this);}
if(!this[moduleName]){reject();}
this[moduleName].start&&this[moduleName].start();resolve();}.bind(this));}.bind(this));},_stop:function(){for(var api in this.REGISTRY){var moduleName=this.REGISTRY[api].charAt(0).toUpperCase()+
this.REGISTRY[api].slice(1);this[moduleName]&&this[moduleName].stop();}}});}(window));