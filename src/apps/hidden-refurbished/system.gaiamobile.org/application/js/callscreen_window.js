'use strict';(function(exports){var CSORIGIN=window.location.origin.replace('system','callscreen')+'/';var CallscreenWindow=function CallscreenWindow(){this.config={manifestURL:CSORIGIN+'manifest.webapp',url:CSORIGIN+'index.html',origin:CSORIGIN};this.isCallscreenWindow=true;this.reConfig(this.config);this.render();if(this._DEBUG){CallscreenWindow[this.instanceID]=this;}
this.publish('created');};CallscreenWindow.prototype=Object.create(AttentionWindow.prototype);CallscreenWindow.prototype.constructor=CallscreenWindow;CallscreenWindow.prototype._DEBUG=false;CallscreenWindow.prototype.CLASS_LIST='appWindow attentionWindow callscreenWindow';CallscreenWindow.prototype.CLASS_NAME='CallscreenWindow';CallscreenWindow.prototype.openAnimation='slide-from-top';CallscreenWindow.prototype.closeAnimation='slide-to-top';CallscreenWindow.SUB_COMPONENTS={'transitionController':window.AppTransitionController,'childWindowFactory':window.ChildWindowFactory};CallscreenWindow.REGISTERED_EVENTS=AttentionWindow.REGISTERED_EVENTS;CallscreenWindow.prototype.render=function cw_render(){this.publish('willrender');this.containerElement.insertAdjacentHTML('beforeend',this.view());this.element=document.getElementById(this.instanceID);this.element.classList.add('statusbar-overlapped');var iframe=document.createElement('iframe');iframe.setAttribute('name','call_screen');iframe.setAttribute('mozbrowser','true');iframe.setAttribute('remote','false');iframe.setAttribute('mozapp',this.config.manifestURL);iframe.setAttribute('src',this.config.url);this.browser={element:iframe};this.browserContainer=this.element.querySelector('.browser-container');this.browserContainer.insertBefore(this.browser.element,null);this.frame=this.element;this.iframe=this.browser.element;this.screenshotOverlay=this.element.querySelector('.screenshot-overlay');this._registerEvents();this.installSubComponents();this.publish('rendered');};CallscreenWindow.prototype.ensure=function(){if(!this.browser||!this.browser.element){return;}
var timestamp=new Date().getTime();var src=this.config.url+'#'+
(Service.query('locked')?'locked':'');src=src+'&timestamp='+timestamp;this.pageURL=this.config.pageURL=src;this.browser.element.setAttribute('src',src);this._terminated=false;};CallscreenWindow.prototype.closeWindow=function(){if(this._terminated){return;}
if(this.frontWindow){this.frontWindow.kill();this.frontWindow=null;}
this._terminated=true;this.publish('terminated');if(this.isActive()){var self=this;this.element.addEventListener('_closed',function onclosed(){self.element.removeEventListener('_closed',onclosed);self.hide();});this.requestClose();}else{this.hide();}
if(document.activeElement===this.browser.element){document.activeElement.blur();}};CallscreenWindow.prototype.reloadWindow=function(){var src=this.browser.element.getAttribute('src').split('#')[0];this.browser.element.removeAttribute('src');setTimeout(function nextTick(){this.browser.element.setAttribute('src',src);}.bind(this));this.setVisible(false);};CallscreenWindow.prototype.free=function(){if(this.browser.element){this.browser.element.removeAttribute('src');}};exports.CallscreenWindow=CallscreenWindow;}(window));