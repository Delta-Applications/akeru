
(function(window){'use strict';var _=navigator.mozL10n.get;var _id=0;var BrowserContextMenu=window.BrowserContextMenu=function(app){this.app=app;this.containerElement=app.element;this.instanceID=_id++;this._injected=false;this.app.element.addEventListener('mozbrowsercontextmenu',this);return this;};BrowserContextMenu.prototype=Object.create(window.BaseUI.prototype);BrowserContextMenu.prototype.CLASS_NAME='BrowserContextMenu';BrowserContextMenu.prototype.ELEMENT_PREFIX='contextmenu-';BrowserContextMenu.prototype.destroy=function(){this.app.element.removeEventListener('mozbrowsercontextmenu',this);this.app=null;};BrowserContextMenu.prototype.customID=function am_customID(){if(this.app){return'['+this.app.origin+']';}else{return'';}};BrowserContextMenu.prototype.handleEvent=function bcm_handleEvent(evt){switch(evt.type){case'mozbrowsercontextmenu':this.show(evt);break;}};BrowserContextMenu.prototype.show=function(evt){var detail=evt.detail;var hasContextMenu=detail.contextmenu&&detail.contextmenu.items.length>0;var hasSystemTargets=detail.systemTargets&&detail.systemTargets.length>0;if(!hasSystemTargets&&!hasContextMenu){return;}
if(!hasContextMenu&&hasSystemTargets&&this.app.isCertified()){return;}
var items=this._listItems(detail);if(!items.length){this._items=null;return;}
evt.preventDefault();evt.stopPropagation();this._items=items;};BrowserContextMenu.prototype._listItems=function(detail){var items=[];if(detail.contextmenu&&detail.contextmenu.items.length){detail.contextmenu.items.forEach(function(choice){items.push({label:choice.label,icon:choice.icon,callback:function(){detail.contextMenuItemSelected(choice.id);}});});}
if(detail.systemTargets){detail.systemTargets.forEach(function(item){this.generateSystemMenuItem(item).forEach(function(menuItem){items.push(menuItem);});},this);}
return items;};BrowserContextMenu.prototype.isVisible=function(){return this.app._optionMenu&&this.app._optionMenu.isActive();};BrowserContextMenu.prototype.hide=function(){this.app._optionMenu&&this.app._optionMenu.hide();};BrowserContextMenu.prototype.shareUrl=function(url){new MozActivity({name:'share',data:{type:'url',url:url}});};BrowserContextMenu.prototype.generateSystemMenuItem=function(item){var nodeName=item.nodeName.toUpperCase();var uri=item.data.uri;switch(nodeName){case'IMG':case'VIDEO':case'AUDIO':var typeMap={'IMG':'image','VIDEO':'video','AUDIO':'audio'};var type=typeMap[nodeName];if(nodeName==='VIDEO'&&!item.data.hasVideo){type='audio';}
return[{id:'save-'+type,label:_('save-'+type),callback:this.app.browser.element.download.bind(this.app.browser.element,uri)},{id:'share-'+type,label:_('share-'+type),callback:this.shareUrl.bind(this,uri)}];default:return[];}};BrowserContextMenu.prototype.hasAction=function(type){if(this._items&&this._items.length>0){return this._items.some((element)=>{return(element.id&&(element.id===type));});}else{return false;}};BrowserContextMenu.prototype.getActionCallback=function(type){let actionIndex=null;this._items.some((element,index)=>{if(element.id&&(element.id===type)){actionIndex=index;return true;}});if(actionIndex>=0){return this._items[actionIndex].callback;}else{return function(){};}};}(this));