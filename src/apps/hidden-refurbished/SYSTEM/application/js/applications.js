'use strict';(function(exports){function Applications(){}
Applications.prototype={installedApps:{},ready:false,stop:function a_stop(){this.ready=false;this.installedApps={};navigator.mozApps.mgmt.getAll().onsuccess=null;navigator.mozApps.mgmt.oninstall=null;navigator.mozApps.mgmt.onuninstall=null;navigator.mozApps.mgmt.onupdate=null;navigator.mozApps.mgmt.onenabledstatechange=null;},start:function a_start(){var self=this;var apps=navigator.mozApps;var getAllApps=function getAllApps(){navigator.mozApps.mgmt.getAll().onsuccess=function mozAppGotAll(evt){var apps=evt.target.result;apps.forEach(function(app){self.installedApps[app.manifestURL]=app;});self.ready=true;self.fireApplicationReadyEvent();};};if(window.sessionStorage.getItem('webapps-registry-ready')){getAllApps();}else{window.addEventListener('mozChromeEvent',function mozAppReady(event){if(event.detail.type!='webapps-registry-ready'){return;}
window.sessionStorage.setItem('webapps-registry-ready','yes');window.removeEventListener('mozChromeEvent',mozAppReady);getAllApps();});}
apps.mgmt.oninstall=function a_install(evt){var newapp=evt.application;self.installedApps[newapp.manifestURL]=newapp;self.fireApplicationInstallEvent(newapp);};apps.mgmt.onuninstall=function a_uninstall(evt){var deletedapp=evt.application;delete self.installedApps[deletedapp.manifestURL];self.fireApplicationUninstallEvent(deletedapp);};apps.mgmt.onupdate=function a_update(evt){var updatedapp=evt.application;self.installedApps[updatedapp.manifestURL]=updatedapp;self.fireApplicationUpdateEvent(evt.application);};apps.mgmt.onenabledstatechange=function a_enabledstatechange(evt){let statechangeapp=evt.application;self.installedApps[statechangeapp.manifestURL]=statechangeapp;self.fireApplicationEnabledStateChangeEvent(evt.application);};},getByManifestURL:function a_getByManifestURL(manifestURL){if(manifestURL in this.installedApps){return this.installedApps[manifestURL];}
return null;},fireApplicationReadyEvent:function a_fireAppReadyEvent(){window.performance.measure("applications-ready","applications-start");var evt=new CustomEvent('applicationready',{bubbles:true,cancelable:false,detail:{applications:this.installedApps}});window.dispatchEvent(evt);},fireApplicationInstallEvent:function a_fireApplicationInstallEvent(app){var evt=new CustomEvent('applicationinstall',{bubbles:true,cancelable:false,detail:{application:app}});window.dispatchEvent(evt);},fireApplicationUninstallEvent:function a_fireApplicationUninstallEvent(app){var evt=new CustomEvent('applicationuninstall',{bubbles:true,cancelable:false,detail:{application:app}});window.dispatchEvent(evt);},fireApplicationUpdateEvent:function a_fireApplicationUpdateEvent(app){var evt=new CustomEvent('applicationupdate',{bubbles:true,cancelable:false,detail:{application:app}});window.dispatchEvent(evt);},fireApplicationEnabledStateChangeEvent:function a_fireApplicationEnabledStateChangeEvent(app){let evt=new CustomEvent('applicationenabledstatechange',{bubbles:true,cancelable:false,detail:{application:app}});window.dispatchEvent(evt);}};exports.Applications=Applications;}(window));window.performance.mark("applications-start");window.applications=new Applications();applications.start();