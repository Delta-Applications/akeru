'use strict';(function(exports){var SecureWindowFactory=function(){this.initEvents();};SecureWindowFactory.prototype={states:{apps:{}},configs:{listens:['secure-launchapp','secure-appclosed','secure-appterminated','secure-modeon','secure-modeoff']}};SecureWindowFactory.prototype.initEvents=function swf_initEvents(){this.configs.listens.forEach((function _initEvent(type){self.addEventListener(type,this);}).bind(this));};SecureWindowFactory.prototype.suspendEvents=function swf_suspendEvents(){this.configs.listens.forEach((function _unbind(ename){self.removeEventListener(ename,this);}).bind(this));};SecureWindowFactory.prototype.suspend=function swf_suspend(){this.suspendEvents();self.addEventListener('secure-modeon',this);for(var origin in this.states.apps){this.unregisterApp(this.states.apps[origin]);}};SecureWindowFactory.prototype.resume=function swf_resume(){this.initEvents();self.removeEventListener('secure-modeon',this);};SecureWindowFactory.prototype.handleEvent=function(evt){switch(evt.type)
{case'secure-launchapp':var{appURL,appManifestURL}=evt.detail;this.create(appURL,appManifestURL);break;case'secure-appclosed':case'secure-appterminated':var app=evt.detail;this.unregisterApp(app);break;case'secure-modeoff':this.suspend();break;case'secure-modeon':this.resume();break;}};SecureWindowFactory.prototype.create=function(url,manifestURL){var config=new self.BrowserConfigHelper({url:url,manifestURL:manifestURL});for(var instanceID in this.states.apps){var secureWindow=this.states.apps[instanceID];if(config.manifestURL===secureWindow.manifestURL){secureWindow.cancelSoftKill();secureWindow.open();return;}}
var app=new self.SecureWindow(config);app.open();this.registerApp(app);};SecureWindowFactory.prototype.registerApp=function(app){this.states.apps[app.instanceID]=app;};SecureWindowFactory.prototype.unregisterApp=function(app){delete this.states.apps[app.instanceID];};exports.SecureWindowFactory=SecureWindowFactory;})(self);