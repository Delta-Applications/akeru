var gDeviceList=null;navigator.mozL10n.once(function(){function e(e){o&&console.log("[Bluetooth APP Device List]: "+e)}var t=navigator.mozL10n.get,n=window.navigator.mozSettings,i=window.navigator.mozBluetooth,r=null,o=!1;n&&i&&(gDeviceList=function(){function n(){_||k||(a(!0),j.clear(),h())}function o(e,n){var i=document.createElement("span"),r=""===e.name?t("unnamed-device"):e.name,o=""===e.name?"unnamed-device":"";i.textContent=r,i.dataset.l10nId=o;var a=document.createElement("small");n&&a.setAttribute("data-l10n-id",n);var s=document.createElement("a");s.appendChild(i),s.appendChild(a);var u=document.createElement("li");return u.classList.add("bluetooth-device"),""===e.icon?u.setAttribute("data-icon","helpx"):u.classList.add("bluetooth-type-"+e.icon),u.appendChild(s),u.dataset.device=e.address,u}function a(e){b.hidden=!e,e?(j.show(!0),x.hidden=!1,w.classList.remove("visible")):(j.show(!1),O.show(!1),x.hidden=!0,k=null,E=null,L=null,clearTimeout(S),S=null)}function s(e,t,n,i){y.hidden=!1,r=e,r.onpairedstatuschanged=function(e){d(e.status,"Authentication Failed",e.address)},r.ondiscoverystatechanged=function(e){var t=j.list.childNodes;e.discovering?x.hidden=!1:(0==t.length&&w.classList.add("visible"),x.hidden=!0,clearTimeout(S),S=null),i(e.discovering)},A=t,I=n,c()}function u(){y.hidden=!0,r=null}function c(){if(i.enabled&&r){var e=r.getPairedDevices();e.onsuccess=function(){function t(){return function(e){var t=e.address===L?"device-status-connected":"",n=o(e,t);O.list.appendChild(n),O.index[e.address]=[e,n]}}var n=e.result.slice(),i=n.length;if(0===i)return O.show(!1),void 0;O.clear(),n.sort(function(e,t){return e.name>t.name});for(var r=0;i>r;r++)t()(n[r]);O.show(!0)}}}function l(e){var t=e.device,n=j.index[t.address]||O.index[t.address];if(n){var i=n[1];if(t.name&&i){var r=i.querySelector("a > span");r&&(r.dataset.l10nId="",r.textContent=t.name)}}else{var a=o(t,"device-status-tap-connect");j.list.appendChild(a),j.index[t.address]=[t,a]}}function d(t,n,i){if(k){var r=k;if(k=null,t){if(j.index[r]){var o=j.index[r][0],a=j.index[r][1];j.list.removeChild(a),delete j.index[r],E=r,v(o)}c()}else{var s="error-pair-title";"Repeated Attempts"===n?s="error-pair-toofast":"Authentication failure"===n&&(s="error-pair-pincode"),e(s);var u=document.getElementById("unable-pair-view"),l=document.getElementById("error-pair-desc"),d=document.getElementById("search-devices-list-view");l.setAttribute("data-l10n-id",s),d.hidden=!0,d.classList.remove("current"),u.hidden=!1,u.classList.add("current"),u.dataset.workingAddress=r}}else if(c(),i&&t&&j.index[i]){var f=j.index[i][1];j.list.removeChild(f),delete j.index[i]}}function f(){var e=document.getElementById("unable-pair-view"),t=e.dataset.workingAddress;if(j.index[t]){var n=j.index[t][1].querySelector("small");n.dataset.l10nId="device-status-tap-connect"}c()}function p(n){var i=n.dataset.device;if(m(),!_&&!k){var o=n.querySelector("small");o.textContent=t("device-status-pairing"),o.dataset.l10nId="device-status-pairing";var a=r.pair(i);k=i;var s="pairing with address = "+k;e(s),a.onerror=function(){d(!1,a.error.name)}}}function h(){if(i.enabled&&r&&!S){var e=r.startDiscovery();e.onsuccess=function(){S||(S=setTimeout(m,C))},e.onerror=function(){console.error("Can not discover nearby device")}}}function m(){if(i.enabled&&r&&S){var e=r.stopDiscovery();e.onerror=function(){console.error("Failed to stop discovery of nearby devices")},clearTimeout(S),S=null}}function v(e){_=!0,A&&A(e)}function g(e){var n=e.dataset.device,i=O.index[n][0];if(!_&&!k){m();var r=e.querySelector("small");r.textContent=t("device-status-connecting"),r.dataset.l10nId="device-status-connecting",v(i)}}var y=document.getElementById("devices-list-view"),b=document.getElementById("bluetooth-search"),w=document.getElementById("nodevices-nearby"),x=document.getElementById("bluetooth-searching");document.getElementById("devices-list-header");var k=null,E=null,L=null,C=6e4,S=null,A=null,I=null,_=!1;document.body.classList.toggle("large-text",navigator.largeTextEnabled);var O={list:document.getElementById("bluetooth-paired-devices"),index:[],clear:function(){for(;this.list.hasChildNodes();)this.list.removeChild(this.list.lastChild);this.index=[]},show:function(e){e||this.clear(),this.list.hidden=!e}},j={list:document.getElementById("bluetooth-devices"),index:[],clear:function(){for(;this.list.hasChildNodes();)this.list.removeChild(this.list.lastChild);this.index=[]},show:function(e){e||this.clear(),this.list.hidden=!e}};return{update:a,initWithAdapter:s,uninit:u,startDiscovery:h,stopDiscovery:m,onDeviceFound:l,searchAgain:n,unablePairCallback:f,pairDevice:p,sendFile:g}}())});