{"version":3,"sources":["backend/installer/self-debug.js","backend/installer/mozapps-import.js","backend/install-app.js","ui/Tabs.js","ui/Tab.js","ui/TabView.js","ui/SoftKey.js","ui/Focus.js","ui/SelectPopup.js","ui/RadioButtonListItem.js","Toaster.js","ui/TextInput.js","AppDetail.js","AppView.js","AppButton.js","AppList.js","Search.js","backend/AppStore.js","backend/appstore/bhackers-v2.js","backend/appstore/kaistone-requester.js","backend/appstore/kaistone.js","Store.js","Setup.js","App.js","serviceWorker.js","index.js","backend/check-installed.js","backend/pkgutils.js","backend/Installer.js"],"names":["token_alphabet","binary_name","daemon_base","token_file","daemon_init_cmd","concat","inst","SelfDebugInstaller","_this","Object","_builds_affenull2345_store_client_node_modules_babel_preset_inferno_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","this","_super","call","loading","Promise","resolve","reject","failure","t","alert","token","i","Math","floor","random","length","start","cmd","navigator","engmodeExtension","startUniversalCommand","onsuccess","setTimeout","onerror","e","xhr","XMLHttpRequest","open","responseType","onload","save","storage","req","addNamed","response","console","log","error","status","storages","getDeviceStorages","del_req","delete","send","then","client","FirefoxClient","connect","on","Error","name","message","getWebapps","err","webapps","installedId","manifestURL","pkg","idHint","_this2","load","interfaces","id","blobToBuffer","buf","installPackaged","appId","close","info","catch","Installer","getAllCachedPromise","cachedGetAll","mozApps","mgmt","getAll","result","onuninstall","oninstall","installStatusUpdate","emit","MozAppsImportedApp","mozApp","_mozApp","launch","uninstall","manifest","version","origin","replace","InstalledApp","import","app","DOMError","url","URL","all","_step","_iterator","_createForOfIteratorHelper","s","n","done","value","f","manifest_url","displayName","_step2","uuid_origin","_iterator2","test","installers","require","default","installApp","_x","_x2","_x3","_installApp","apply","arguments","_callee","progress","_app$getInstallationM","_app$getInstallationM2","method","loader","_loop","_ret","_regeneratorRuntime","wrap","_context2","prev","next","getInstallationMethod","_builds_affenull2345_store_client_node_modules_babel_preset_inferno_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__","mark","loaded","_installers$i","_context","what","amount","sent","_builds_affenull2345_store_client_node_modules_babel_preset_inferno_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__","args","t0","abrupt","v","t1","stop","delegateYield","Tabs","props","classCallCheck","state","index","childRefs","handleKeyDown_bound","handleKeyDown","bind","document","addEventListener","removeEventListener","children","map","tab","cloneVNode","isActive","ref","node","index_esm","renderChildren","idx","key","setTabActive","setState","onChangeIndex","scrollIntoView","findDOMNode","behavior","block","inline","Component","Tab","cls","label","TabView","active","tabLabels","ui_Tab_Tab","child","ui_Tabs_Tabs","handleChangeIndex","renderTabs","renderContent","SoftKeyButton","preventDefault","handleClick","relatedTarget","focus","currentTarget","blur","renderedIcon","icon","toString","indexOf","src","width","height","alt","text","onClick","onFocus","handleFocus","data-icon","SoftKey","leftCallback","rightCallback","centerCallback","stopPropagation","keyboardReceiver","SoftKey_SoftKeyButton","pos","leftText","leftIcon","centerText","centerIcon","rightText","rightIcon","Focus","settings","Array","isArray","focusIntoView","modalRoot","getElementById","SelectPopup","handleKeydown","evt","onClose","selected","el","createElement","className","tabIndex","appendChild","removeChild","_this$props","header","createPortal","ui_SoftKey_SoftKey","activeElement","dispatchEvent","MouseEvent","RadioButtonListItem","isFocused","buttonRef","buttonCls","type","checked","isChecked","handleButtonFocus","onBlur","onSelect","conn","toast","msg","getSelf","forEach","postMessage","warn","TextInput","focused","handleBlur","onChange","handleChange","placeholder","inp","AppDetail","extendedMetadata","getExtendedMetadata","metadata","meta","keys","description","renderExtendedMetadata","AppView","installState","locked","installedApp","window","confirm","downloading","_this3","undefined","stage","_this4","downloadPackage","blob","createObjectURL","a","href","download","revokeObjectURL","location","reload","boxRef","scrollBy","top","left","subscribe","updateInstallState","unsubscribe","_this5","checkInstalled","checkUpdatable","updatable","_this6","style","findIcon","AppDetail_AppDetail","r","install","AppButton","btn","AppView_AppView","AppList","canNavigateUp","onNavigateUp","apps","isLastPage","loadNextPage","loadedPages","savedFilters","filters","after","nextPage","store","getApps","_ref","useFocus","duration","AppButton_AppButton","renderApps","Search","handleKeyup","searchActive","updateKeywords","keywords","appList","search","activateSearch","AppList_AppList","ui_TextInput_TextInput","split","filter","AppStore","StoreApp","BHACKERS_SERVERS","BHACKERS_RATINGS","request","meth","rtype","data","mozSystem","ontimeout","onprogress","total","countDownload","_callee4","rating_servers","slug","srv","_context4","finish","loadSRSData","_callee5","reg","saveName","obj","saved","_context5","JSON","parse","localStorage","setItem","getItem","loadAppData","_callee6","servers","_iterator3","_step3","_context6","_callee7","_context7","downloadCount","BHackersV2App","ratings","dataVersion","_data","_dataVersion","_downloadCount","blobPromise","manifestPromise","str","loadManifest","mf","developer","author","join","source","git_repo","has_ads","has_tracking","license","download_count","size","asyncToGenerator","reportProgress","toLowerCase","t2","_x7","_callee2","_callee3","_context3","compareVersions","BHackersV2Store","_super2","loadData","categories","special","ctg","count","_this7","origSet","score","kw","includes","tags","tag","new_app","create","searchScore","filteredSet","match","some","ct","sort","b","slice","Requester","auth","api","dev","brand","device_id","imei","device_type","model","os","os_version","reference","cu","path","headers","Authorization","hawkinfo","payload","contentType","stringify","server","setRequestHeader","ver","Date","now","mcc","mnc","ua","credentials","kid","algorithm","Buffer","mac_key","hawk","responseText","desc","cause","statusText","TypeError","getKaiOSVersion","kaiUA","exec","userAgent","KaiStoneApp","requester","display","preferredSize","thumbnail_url","sizes","icons","bestSize","currentDiff","diff","developer_url","kaistone_regeneratorRuntime","package_path","t3","t4","t5","t6","t7","KaiStone","loadPromise","ctgs","isSearch","clientSideCategoryFilter","encodeURIComponent","code","language","filtered","organic","category_list","page","total_pages","last_page","Store","stores","searchOpen","popup","selecting","SelectPopup_SelectPopup","ui_RadioButtonListItem_RadioButtonListItem","storeLoadComplete","Search_Search","tabs","labels","ui_TabView_TabView","Setup","cb","onSetup","App","setupDone","Store_Store","src_Setup_0","Boolean","hostname","mozSettings","createLock","set","debugger.remote-mode","render","src_App_0","serviceWorker","ready","registration","unregister","callbacks","push","cb2","_checkInstalled","_app$getIdentificatio","_app$getIdentificatio2","getIdentificationMethod","_builds_affenull2345_store_client_node_modules_babel_preset_inferno_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","unpack","zip","metafile","appfile","JSZip","loadAsync","file","async","extractManifest","calledFromImplementation","unpacked","installPackage","Installer_regeneratorRuntime","checkInstalledByOrigin","generateAsync","pack","packed","importPackage"],"mappings":"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","file":"static/js/main.080d351a.chunk.js","sourcesContent":["/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport FirefoxClient from 'firefox-client';\nimport blobToBuffer from 'blob-to-buffer';\n//import { extractManifest } from '../pkgutils';\nimport { Installer } from '../Installer';\n\nconst token_alphabet = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_.\";\nconst binary_name = 'debug-forwarder';\nconst daemon_base = '/data/local/service/debug-forwarder';\nconst token_file = '.forwarder_token';\nconst storage_1 = '/data/media';\nconst storage_2 = '/sdcard';\nconst debug_file = '/sdcard/store-self-debug.log';\nconst daemon_init_cmd =\n  /* preparation block */\n  `(mkdir -p ${daemon_base} && ` +\n  `(cp ${storage_1}/tmp.${binary_name}.bin ${daemon_base}/${binary_name} || ` +\n  `cp ${storage_2}/tmp.${binary_name}.bin ${daemon_base}/${binary_name}) && ` +\n  `echo 'Copied daemon to ${daemon_base}/' && ` +\n  `chmod 700 ${daemon_base}/${binary_name}) > ${debug_file} 2>&1; ` +\n  /* launch block */\n  `${daemon_base}/${binary_name} 6000 /data/local/debugger-socket 127.0.0.1` +\n  `>/dev/null </dev/null 2>/dev/null & ` +\n  /* post-launch message */\n  `echo 'Started daemon' > ${debug_file}; `;\n\nfunction daemonInit(){\n  return new Promise((resolve, reject) => {\n    function failure(t){\n      alert(`Something went wrong with the daemon initialization.\nPlease manually follow the instructions at https://gitlab.com/affenull2345/kaios-self-debug and run the following command in 'adb shell'; then dismiss this dialog:\n\nprintf '${t}' > '${daemon_base}/${token_file}'\n\nIf the problem persists, please create an issue at https://gitlab.com/affenull2345/store-client and mention your phone model, firmware version and KaiOS version.`);\n    }\n    let token = \"\";\n    for(let i = 0; i < 32; i++){\n      token += token_alphabet[\n        Math.floor(Math.random() *\n          token_alphabet.length)];\n    }\n    function start(){\n      try {\n        let cmd = navigator\n          .engmodeExtension.startUniversalCommand(\n            daemon_init_cmd +\n            `printf '${token}' > '${daemon_base}/${token_file}'`,\n            true\n          );\n        cmd.onsuccess = function(){\n          // Wait for the daemon to spin up\n          setTimeout(() => resolve(token), 500);\n        }\n        cmd.onerror = function(){\n          failure(token);\n          resolve(token);\n        }\n      }\n      catch(e){\n        failure(token);\n        resolve(token);\n      }\n    }\n    let xhr = new XMLHttpRequest();\n    xhr.open('GET', `/${binary_name}.bin`, true);\n    xhr.responseType = 'blob';\n    xhr.onload = function(){\n      function save(storage){\n        let req = storage.addNamed(xhr.response, `tmp.${binary_name}.bin`);\n        req.onsuccess = function(){\n          console.log('[self-debug] Daemon saved to sdcard0');\n          start();\n        }\n        req.onerror = function(){\n          console.error('[self-debug] Failed to save daemon', req.error);\n          start();\n        }\n      }\n      if(xhr.status === 200 && xhr.response){\n        console.log('[self-debug] Loaded daemon', xhr.response);\n        let storages = navigator.getDeviceStorages('sdcard');\n        let del_req = storages[0].delete(`tmp.${binary_name}.bin`);\n        del_req.onsuccess = function(){\n          console.log('[self-debug] Deleted old daemon file on sdcard0');\n          save(storages[0]);\n        }\n        del_req.onerror = function(){\n          console.log('[self-debug] Did not delete old daemon file');\n          save(storages[0]);\n        }\n      }\n      else {\n        console.log('[self-debug] Could not load daemon, unexpected result');\n        start();\n      }\n    }\n    xhr.onerror = function(){\n      console.error('[self-debug] Could not load daemon, XHR failed');\n      start();\n    }\n    try {\n      xhr.send();\n    }\n    catch(e) {\n      console.error('[self-debug] Could not load daemon', e);\n      start();\n    }\n  });\n}\n\nclass SelfDebugInstaller extends Installer {\n  constructor(){\n    super();\n    this.loading = null;\n  }\n  load() {\n    this.loading = daemonInit().then(token => {\n      return new Promise((resolve, reject) => {\n        var client = new FirefoxClient();\n        client.connect('127.0.0.1', 6000, token, () => {\n          resolve(client);\n        });\n        client.on('error', e => {\n          reject(new Error(e.name + ' (' + e.message + ')'));\n        });\n        client.on('end', e => {\n          reject();\n        });\n      });\n    }).then(client => {\n      return new Promise((resolve, reject) => {\n        client.getWebapps((err, webapps) => {\n          if(err) reject(err);\n          else resolve({\n            client,\n            webapps\n          });\n        });\n      });\n    });\n  }\n  installPackage(installedId, manifestURL, pkg, idHint){\n    if(!this.loading){\n      this.load();\n    }\n    return this.loading.then(interfaces => {\n      var id = idHint ? '{' + idHint + '}' : installedId;\n      return new Promise((resolve, reject) => {\n        console.log(`[self-debug] appId=${id}, installing`, pkg);\n        blobToBuffer(pkg, (err, buf) => {\n          if(err) reject(err);\n          interfaces.webapps.installPackaged(buf, id, (e, appId) => {\n            interfaces.webapps.close(`app://${appId}/manifest.webapp`, e => {\n              if(e) console.info('Could not close app', e);\n            });\n            if(e) reject(e);\n            else resolve();\n          });\n        });\n      });\n    }).catch(e => {\n      this.loading = null; // Retry next time\n      return Promise.reject(e);\n    });\n  }\n  /* checkInstalled should fall back to mozApps-based installer */\n  get name(){\n    return 'self-debug';\n  }\n}\n\nconst inst = new SelfDebugInstaller();\n\nexport default inst;\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { installStatusUpdate } from '../check-installed';\nimport { Installer, InstalledApp } from '../Installer';\n\nvar getAllCachedPromise = null;\n\nif(navigator.mozApps && navigator.mozApps.mgmt){\n  navigator.mozApps.mgmt.onuninstall = navigator.mozApps.mgmt.oninstall = ()=>{\n    getAllCachedPromise = null;\n    installStatusUpdate.emit();\n  }\n}\n\nfunction cachedGetAll(){\n  if(!getAllCachedPromise){\n    getAllCachedPromise = new Promise((resolve, reject) => {\n      var req = navigator.mozApps.mgmt.getAll();\n      req.onsuccess = function(){\n        resolve(req.result);\n      }\n      req.onerror = function(){\n        reject(new Error(req.error.name + ' ' + req.error.message));\n      }\n    });\n  }\n  return getAllCachedPromise;\n}\n\nclass MozAppsImportedApp extends InstalledApp {\n  constructor(mozApp){\n    super();\n    this._mozApp = mozApp;\n  }\n  open() {\n    this._mozApp.launch();\n  }\n  uninstall() {\n    return new Promise((resolve, reject) => {\n      var req = navigator.mozApps.mgmt.uninstall(this._mozApp);\n      req.onsuccess = function(){\n        resolve();\n      }\n      req.onerror = function(){\n        reject(new Error(req.error.name + ' ' + req.error.message));\n      }\n    });\n  }\n  get version() {\n    return this._mozApp.manifest.version;\n  }\n  get idHint() {\n    const prefix = /^app:\\/\\//;\n    return this._mozApp.origin.replace(prefix, '');\n  }\n}\n\nclass MozAppsImportInstaller extends Installer {\n  importPackage(installedId, pkg, idHint){\n    return navigator.mozApps.mgmt.import(pkg).then(app => {\n      return Promise.resolve();\n    }).catch(e => {\n      if(e instanceof DOMError){\n        return Promise.reject(new Error(e.name + ' ' + e.message));\n      }\n    });\n  }\n  checkInstalledByOrigin(origin){\n    var url = new URL(origin);\n    return cachedGetAll().then(all => {\n      for(const app of all){\n        if(app.origin === url.origin ||\n          app.manifestURL === `app://${url.origin}/manifest.webapp`)\n        {\n          return Promise.resolve(new MozAppsImportedApp(app));\n        }\n      }\n    });\n  }\n  checkInstalled(manifest_url, idHint, displayName){\n    return cachedGetAll().then(all => {\n      const uuid_origin\n        = /^app:\\/\\/\\{[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}\\}/;\n      for(const app of all){\n        if(app.manifestURL === manifest_url ||\n          app.manifestURL === `app://{${idHint}}/manifest.webapp` ||\n          app.origin === `app://{${idHint}}` ||\n          app.origin === idHint ||\n          ((uuid_origin.test(app.origin) || !idHint)\n            && app.manifest && app.manifest.name === displayName))\n        {\n          return Promise.resolve(new MozAppsImportedApp(app));\n        }\n      }\n    });\n  }\n  get name(){\n    return 'mozApps-import';\n  }\n}\n\nconst inst = new MozAppsImportInstaller();\n\nexport default inst;\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst installers = [\n  require('./installer/self-debug').default,\n  require('./installer/mozapps-import').default,\n];\n\nexport { installers };\n\nexport default async function installApp(app, installedId, progress){\n  let error = new Error('No installers found');\n  let [method, loader] = app.getInstallationMethod();\n  for(let i = 0; i < installers.length; i++){\n    let loaded = false;\n    let result = await loader((what, amount) => {\n      if(!loaded) progress(what, amount);\n    });\n    loaded = true;\n\n    try {\n      console.log(`Trying with ${installers[i].name}.${method}`);\n      progress(`Installing [${installers[i].name}]` +\n        (installers[i].name === 'self-debug' ?\n        ' - be patient!' : ''));\n      return await installers[i][method](installedId, ...result.args);\n    } catch(e) {\n      console.error('Install error', e);\n      error = e;\n    }\n  }\n  throw error;\n}\n","/*\n * KaiUI wrapper for InfernoJS\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Component } from 'inferno';\nimport { cloneVNode } from 'inferno-clone-vnode';\nimport { findDOMNode } from 'inferno-extras';\nimport scrollIntoView from 'smooth-scroll-into-view-if-needed';\nimport 'KaiUI/src/components/Tabs/Tabs.scss';\n\nexport default class Tabs extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      index: 0\n    };\n    this.childRefs = [];\n  }\n  componentDidMount() {\n    this.handleKeyDown_bound = this.handleKeyDown.bind(this);\n    document.addEventListener('keydown', this.handleKeyDown_bound);\n  }\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeyDown_bound);\n  }\n  renderChildren() {\n    return this.props.children.map((tab, i) => {\n      return cloneVNode(tab, {\n        isActive: this.state.index === i,\n        ref: node => this.childRefs[i] = node\n      });\n    });\n  }\n  render() {\n    return (\n      <div className='kai-tabs'>{this.renderChildren()}</div>\n    );\n  }\n  handleKeyDown(e){\n    var idx = this.state.index;\n    if(e.key === 'ArrowLeft'){\n      this.setTabActive(idx, false);\n      idx--;\n      if(idx < 0) idx = this.props.children.length - 1;\n      this.setTabActive(idx, true);\n      this.setState({index: idx});\n      if(this.props.onChangeIndex) this.props.onChangeIndex(idx);\n    }\n    else if(e.key === 'ArrowRight'){\n      this.setTabActive(idx, false);\n      idx++;\n      if(idx >= this.props.children.length) idx = 0;\n      this.setTabActive(idx, true);\n      this.setState({index: idx});\n      if(this.props.onChangeIndex) this.props.onChangeIndex(idx);\n    }\n  }\n  setTabActive(idx, isActive) {\n    if(this.props.children.length > idx){\n      this.props.children[idx].props.isActive = isActive;\n      if(isActive && this.childRefs[idx]){\n        scrollIntoView(findDOMNode(this.childRefs[idx]), {\n          behavior: 'smooth',\n          block: 'start',\n          inline: 'center'\n        });\n      }\n    }\n  }\n}\n","/*\n * KaiUI wrapper for InfernoJS\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Component } from 'inferno';\nimport 'KaiUI/src/components/Tab/Tab.scss';\n\nexport default class Tab extends Component {\n  render() {\n    const cls = this.props.isActive ? 'kai-tab-active' : 'kai-tab-inactive';\n    return (\n      <div className={cls}>\n        <div className={cls + '-label'}>{this.props.label}</div>\n      </div>\n    );\n  }\n}\n","/*\n * KaiUI wrapper for InfernoJS\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Component } from 'inferno';\nimport 'KaiUI/src/views/TabView/TabView.scss';\nimport Tabs from './Tabs';\nimport Tab from './Tab';\n\nexport default class TabView extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      active: 0\n    };\n  }\n  handleChangeIndex(idx) {\n    this.setState({active: idx});\n  }\n  renderTabs() {\n    return this.props.tabLabels.map((tab, i) => (\n      <Tab label={tab} />\n    ));\n  }\n  renderContent() {\n    return this.props.children.map((child, i) => (\n      i === this.state.active ? child : null\n    ));\n  }\n  render() {\n    return (\n      <div className='kai-tab-view'>\n        <div className='kai-tab-view-tabs'>\n          <Tabs onChangeIndex={this.handleChangeIndex.bind(this)}>\n            {this.renderTabs()}\n          </Tabs>\n        </div>\n        <div className='kai-tab-view-content'>\n          {this.renderContent()}\n        </div>\n      </div>\n    );\n  }\n}\n","/*\n * KaiUI wrapper for InfernoJS\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n * Most of this is directly copied from KaiUI, which is (C) Adrian Machado\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Component } from 'inferno';\nimport 'KaiUI/src/kai-font/style.css';\nimport 'KaiUI/src/components/SoftKey/SoftKey.scss';\n\nclass SoftKeyButton extends Component {\n  handleClick(e) {\n    e.preventDefault();\n    if(this.props.handleClick) this.props.handleClick();\n  }\n  // We want to avoid losing focus on the parent element\n  handleFocus(e){\n    e.preventDefault();\n    if(e.relatedTarget){\n      // Revert focus back to previous blurrint element\n      e.relatedTarget.focus();\n    }\n    else {\n      // No previous focus target, blur instead\n      e.currentTarget.blur();\n    }\n  }\n  render() {\n    var renderedIcon = null;\n    if(this.props.icon){\n      if(this.props.icon.toString().indexOf('kai-') === -1){\n        renderedIcon = <img src={this.props.icon} width={20} height={20}\n          alt='' />;\n      }\n      else {\n        renderedIcon = <span className={this.props.icon} />;\n      }\n    }\n    return (\n      <button\n        id={this.props.id}\n        className='kai-softkey-btn'\n        onClick={this.handleClick.bind(this)}\n        onFocus={this.handleFocus.bind(this)}\n        data-icon={renderedIcon ? 'true' : null}\n      >\n        {renderedIcon}{this.props.text}\n      </button>\n    );\n  }\n}\n\nexport default class SoftKey extends Component {\n  handleKeyDown = (e) => {\n    switch(e.key){\n      case '<':\n      case 'SoftLeft':\n        if(this.props.leftCallback) this.props.leftCallback();\n        break;\n      case '>':\n      case 'SoftRight':\n        if(this.props.rightCallback) this.props.rightCallback();\n        break;\n      case 'Enter':\n        if(this.props.centerCallback) this.props.centerCallback();\n        break;\n      default:\n        return;\n    }\n    /* if this event was received by this softkey, other softkeys in parent\n     * receivers should not get it */\n    e.stopPropagation();\n  }\n  componentDidMount() {\n    this.keyboardReceiver = this.props.keyboardReceiver || document;\n    this.keyboardReceiver.addEventListener('keydown', this.handleKeyDown);\n  }\n  componentWillUnmount() {\n    this.keyboardReceiver.removeEventListener('keydown', this.handleKeyDown);\n  }\n  render() {\n    return (\n      <div className='kai-softkey visible'>\n        <SoftKeyButton\n          id='sk-left'\n          pos='left'\n          text={this.props.leftText}\n          icon={this.props.leftIcon}\n          handleClick={this.props.leftCallback} />\n        <SoftKeyButton\n          id='sk-center'\n          pos='center'\n          text={this.props.centerText}\n          icon={this.props.centerIcon}\n          handleClick={this.props.centerCallback} />\n        <SoftKeyButton\n          id='sk-right'\n          pos='right'\n          text={this.props.rightText}\n          icon={this.props.rightIcon}\n          handleClick={this.props.rightCallback} />\n      </div>\n    );\n  }\n}\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { findDOMNode } from 'inferno-extras';\nimport { cloneVNode } from 'inferno-clone-vnode';\nimport scrollIntoView from 'smooth-scroll-into-view-if-needed';\n\nfunction focusIntoView(ref, settings){\n  var node = findDOMNode(ref);\n  if(node){\n    setTimeout(() => {\n      node.focus()\n    }, 10);\n    scrollIntoView(node, settings);\n  }\n}\n\nexport default function Focus(props){\n  const { children, settings, isActive } = props;\n  const child = Array.isArray(children) ? children[0] : children;\n  return cloneVNode(child, {\n    ref: isActive ? node => {\n      focusIntoView(node, settings || {\n        behavior: 'auto',\n        block: 'nearest',\n        inline: 'start'\n      });\n    } : null\n  });\n}\n","/*\n * KaiUI wrapper for InfernoJS\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* This component is a derivative of KaiUI's Dialog */\n\nimport { Component, createPortal } from 'inferno';\nimport Focus from './Focus';\nimport SoftKey from './SoftKey';\nimport 'KaiUI/src/components/Dialog/Dialog.scss';\nimport './SelectPopup.css';\n\n/* focus logging\nHTMLElement.prototype.realFocus = HTMLElement.prototype.focus;\nHTMLElement.prototype.focus = function(){\n  console.log('focus', this);\n  this.realFocus();\n}\n*/\n\nconst modalRoot = document.getElementById('modal-root');\n\nexport default class SelectPopup extends Component {\n  constructor(props) {\n    super(props);\n    this.el = document.createElement('div');\n    this.el.className = 'kai-dialog';\n    this.el.tabIndex = 0;\n    this.state = {\n      selected: 0\n    };\n  }\n  handleKeydown = (evt) => {\n    // A modal should intercept all keys received, to avoid\n    // having them handled by other components\n    evt.stopPropagation();\n    if(evt.key !== 'Enter') evt.preventDefault();\n\n    switch(evt.key){\n      case 'Backspace':\n        this.props.onClose && this.props.onClose();\n        break;\n      case 'ArrowDown':\n        this.setState({\n          selected: (this.state.selected + 1) % this.props.children.length || 0\n        });\n        break;\n      case 'ArrowUp':\n        this.setState({\n          selected: (this.state.selected + this.props.children.length - 1) %\n            this.props.children.length || 0\n        });\n        break;\n      default:\n        break;\n    }\n  }\n  componentDidMount() {\n    modalRoot.appendChild(this.el);\n    this.el.addEventListener('keydown', this.handleKeydown);\n  }\n  componentWillUnmount() {\n    this.el.removeEventListener('keydown', this.handleKeydown);\n    modalRoot.removeChild(this.el);\n  }\n  render() {\n    const {\n      header,\n      children,\n      onClose,\n    } = this.props;\n    return createPortal(\n      <>\n        <div className=\"kai-dialog-wrapper\">\n          {header && <div className=\"kai-dialog-header h1\">{header}</div>}\n          <div className=\"select-popup-container\">\n            {children.map((child, i) =>\n              <Focus isActive={this.state.selected === i}>{child}</Focus>\n            )}\n          </div>\n        </div>\n        <SoftKey\n          leftText=\"Cancel\"\n          leftCallback={() => { onClose && onClose() }}\n          centerText=\"Select\"\n          centerCallback={() => {\n            document.activeElement.dispatchEvent(new MouseEvent('click'));\n          }}\n          keyboardReceiver={this.el}\n        />\n      </>,\n      this.el\n    );\n  }\n}\n","/*\n * KaiUI wrapper for InfernoJS\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Component } from 'inferno';\nimport 'KaiUI/src/components/RadioButtonListItem/RadioButtonListItem.scss';\nimport './RadioButtonListItem.css';\n\nexport default class RadioButtonListItem extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isFocused: false\n    };\n  }\n  handleFocus() {\n    if(this.buttonRef) this.buttonRef.focus();\n  }\n  handleButtonFocus(isFocused) {\n    this.setState({ isFocused });\n  }\n  render() {\n    const buttonCls =\n      `kai-rbl-button-input-${this.state.isFocused ? 'focused' : 'unfocused'}`;\n    const cls =\n      `kai-rbl${this.state.isFocused ? ' kai-rbl-focused' : ''}`;\n    return (\n      <div className={cls} tabIndex={-1} onFocus={() => this.handleFocus()}>\n        <div className=\"kai-rbl-line left\">\n          <div className=\"kai-rbl-primary\">{this.props.children}</div>\n        </div>\n        <div className=\"kai-rbl-button\">\n          <input\n            className={buttonCls}\n            tabIndex={-1}\n            type=\"radio\"\n            checked={this.props.isChecked}\n            ref={node => this.buttonRef = node}\n            onFocus={() => this.handleButtonFocus(true)}\n            onBlur={() => this.handleButtonFocus(false)}\n            onClick={() => this.props.onSelect && this.props.onSelect()}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n","// Copyright (C) 2021 Affe Null\n/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar conn = null;\n\nfunction startConn(){\n  if(conn) return conn;\n  return conn = new Promise((resolve, reject) => {\n    if(!navigator.mozApps || !navigator.mozApps.getSelf){\n      console.log('No mozApps interface, will disable toaster');\n      reject(new Error('No toaster'));\n    }\n    var req = navigator.mozApps.getSelf();\n    req.onsuccess = function(){\n      req.result.connect('systoaster').then(function(conn){\n        resolve(conn);\n      }).catch(function(e){\n        console.log('Disabling toaster due to connection error',\n          e);\n        reject();\n      });\n    }\n    req.onerror = function(){\n      console.log('Disabling toaster, failed to getSelf()');\n      reject();\n    }\n  });\n}\n\nexport default function toast(msg){\n  startConn().then(conn => {\n    conn.forEach(i => {\n      i.postMessage({message: msg});\n    });\n  }).catch(e => {\n    console.warn(e);\n    alert(msg);\n  });\n}\n","/*\n * KaiUI wrapper for InfernoJS\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Component } from 'inferno';\nimport 'KaiUI/src/components/TextInput/TextInput.scss';\nimport './AppTheme.css';\n\nexport default class TextInput extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      focused: false\n    };\n  }\n  render() {\n    const cls = this.state.focused ?\n        'kai-text-input kai-text-input--focused item-selected' :\n        'kai-text-input';\n    return (\n      <div\n        id={this.props.id}\n        tabIndex={0}\n        className={cls}\n        onFocus={this.handleFocus.bind(this)}\n      >\n        <label className='kai-text-input-label p-thi'>{this.props.label}</label>\n        <input\n          ref={inp => this.inp = inp}\n          type={this.props.type}\n          className='kai-text-input-input p-pri'\n          onBlur={this.handleBlur.bind(this)}\n          onChange={this.handleChange.bind(this)}\n          value={this.props.value}\n          placeholder={this.props.placeholder}\n        />\n      </div>\n    );\n  }\n  handleChange() {\n    this.props.value = this.inp.value;\n    if(this.props.onChange) this.props.onChange();\n  }\n  handleFocus() {\n    if(this.props.onFocus) this.props.onFocus();\n    this.setState({focused: true});\n    this.inp.focus();\n  }\n  handleBlur() {\n    if(this.props.onBlur) this.props.onBlur();\n    this.setState({focused: false});\n  }\n}\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Component } from 'inferno';\nimport './AppDetail.css';\n\nexport default class AppDetail extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      extendedMetadata: null\n    };\n  }\n  renderExtendedMetadata() {\n    if(!this.state.extendedMetadata){\n      this.props.app.getExtendedMetadata().then(metadata => {\n        this.setState({\n          extendedMetadata: metadata\n        });\n      }).catch(e => {\n        this.setState({\n          extendedMetadata: {\n            error: e\n          }\n        });\n      });\n      return null;\n    }\n\n    let meta = this.state.extendedMetadata;\n    return Object.keys(meta).map(key => {\n      switch(key){\n        case 'developer':\n          return <div><b>Developers:</b>{meta[key].name}</div>;\n        case 'license':\n          return <div><b>License:</b>{meta[key]}</div>;\n        case 'download_count':\n          return <div><b>Downloads:</b>{meta[key]}</div>;\n        case 'error':\n          return <div><b>Failed to get metadata:</b>{`${meta[key]}`}</div>;\n        default:\n          return null;\n      }\n    });\n  }\n\n  render() {\n    return (\n      <div className='AppDetail'>\n        <div className='p-sec'>\n          {this.props.app.description}\n        </div>\n        <div className='AppDetailMetadata'>\n          {this.renderExtendedMetadata()}\n        </div>\n      </div>\n    );\n  }\n}\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Component, createPortal } from 'inferno';\nimport { findDOMNode } from 'inferno-extras';\nimport installApp from './backend/install-app';\nimport checkInstalled, { installStatusUpdate } from './backend/check-installed';\nimport SoftKey from './ui/SoftKey';\nimport AppDetail from './AppDetail';\nimport './AppView.css';\n\nconst modalRoot = document.getElementById('modal-root');\n\nexport default class AppView extends Component {\n  constructor(props) {\n    super(props);\n    this.el = document.createElement('div');\n    this.el.className = 'AppViewContainer';\n    this.el.tabIndex = 0;\n    this.state = {\n      status: '',\n      installState: 'unknown',\n      locked: false\n    };\n  }\n  open() {\n    this.installedApp.open();\n  }\n  uninstall() {\n    console.log(this.installedApp);\n    if(this.state.installState === 'not-installed' || !this.installedApp)\n      return;\n    if(!window.confirm('Uninstall ' + this.props.app.name + '?')) return;\n\n    this.installedApp.uninstall().then(() => {\n      this.setState({\n        downloading: false,\n        status: 'Uninstalled',\n        installState: 'not-installed'\n      });\n    });\n  }\n  install() {\n    this.setState({\n      status: 'Installing',\n      locked: true\n    });\n    installApp(this.props.app,\n      this.installedApp ? this.installedApp.idHint : undefined,\n      (stage, progress) => {\n        this.setState({\n          status: 'number' === typeof progress\n            ? `${stage} (${progress}%)`\n            : stage\n        });\n      }).then(() => {\n        this.setState({\n          status: 'Installed!',\n          locked: false\n        });\n      }).catch(err => {\n        alert('While installing app: ' + err);\n        this.setState({\n          status: 'Failed',\n          locked: false\n        });\n      });\n  }\n  download() {\n    this.setState({ downloading: true });\n    this.props.app.downloadPackage().then((blob) => {\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      const nonalpha = /\\W/g;\n      a.download = `${this.props.app.name.replace(nonalpha, '_')}.zip`;\n      a.dispatchEvent(new MouseEvent('click'));\n      this.setState({ downloading: false });\n      setTimeout(() => {\n        URL.revokeObjectURL(url);\n      }, 1000);\n    });\n  }\n  handleKeyDown(e) {\n    // A modal should intercept all keys received, to avoid\n    // having them handled by other components\n    e.stopPropagation();\n    e.preventDefault();\n\n    let node = null;\n    switch(e.key){\n      case 'Backspace':\n        if(this.state.locked){\n          if(window.confirm('Abort installation?')){\n            window.location.reload();\n          }\n        }\n        else if(this.props.onClose){\n          this.props.onClose();\n        }\n        break;\n      case 'ArrowDown':\n        if(this.boxRef) node = findDOMNode(this.boxRef);\n        if(node) node.scrollBy({\n          top: 10,\n          left: 0\n        });\n        break;\n      case 'ArrowUp':\n        if(this.boxRef) node = findDOMNode(this.boxRef);\n        if(node) node.scrollBy({\n          top: -10,\n          left: 0\n        });\n        break;\n      default:\n        break;\n    }\n  }\n\n  componentDidMount() {\n    modalRoot.appendChild(this.el);\n    this.handleKeyDown_bound = this.handleKeyDown.bind(this);\n    this.el.addEventListener('keydown', this.handleKeyDown_bound);\n    this.el.focus();\n    installStatusUpdate.subscribe(this.updateInstallState.bind(this));\n  }\n  componentWillUnmount() {\n    modalRoot.removeChild(this.el);\n    this.el.removeEventListener('keydown', this.handleKeyDown_bound);\n    installStatusUpdate.unsubscribe(this.updateInstallState.bind(this));\n  }\n\n  updateInstallState() {\n    checkInstalled(this.props.app).then(app => {\n      if(app){\n        this.installedApp = app;\n        return this.props.app.checkUpdatable(app.version).then(updatable => {\n          this.setState({\n            installState: updatable ? 'updatable' : 'installed'\n          });\n        });\n      }\n      else {\n        this.setState({\n          installState: 'not-installed'\n        });\n      }\n    }).catch(e => {\n      console.error('Install check failed', e);\n      this.setState({\n        status: 'Install check failed',\n        installState: 'check-failed'\n      });\n    });\n    this.setState({\n      installState: 'checking'\n    });\n  }\n  render() {\n    if(this.state.installState === 'unknown'){\n      this.updateInstallState();\n    }\n    return createPortal(\n      (<>\n        <div className='AppView' ref={r => this.boxRef = r} >\n          <div\n            className='AppViewHeader'\n            style={`background-image: url(${this.props.app.findIcon(60)})`}\n          >\n            <h3>{this.props.app.name}</h3>\n            <div className='AppViewStatus'>{this.state.status}</div>\n          </div>\n          <AppDetail app={this.props.app} />\n        </div>\n        <SoftKey\n          leftText={this.state.downloading ? 'Saving' : 'Save'}\n          centerText={\n            this.state.locked ? '' :\n            this.state.installState === 'installed' ? 'Open' :\n            this.state.installState === 'updatable' ? 'Update' : 'Install'\n          }\n          rightText={\n            this.state.locked ? '' :\n            this.state.installState === 'not-installed' ? '' :\n            this.state.installState === 'checking' ? 'Checking...' :\n            'Uninstall'\n          }\n          leftCallback={() => !this.state.downloading && this.download()}\n          centerCallback={\n            this.state.locked ? null :\n            this.state.installState === 'installed' ? this.open.bind(this) :\n            this.install.bind(this)\n          }\n          rightCallback={this.state.locked ? null : this.uninstall.bind(this)}\n          keyboardReceiver={this.el}\n        />\n      </>),\n      this.el\n    );\n  }\n}\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Component } from 'inferno';\nimport AppView from './AppView';\nimport './AppButton.css';\n\nexport default class AppButton extends Component {\n  constructor(props){\n    super(props);\n    this.state = {\n      focused: false,\n      open: false\n    };\n  }\n  render() {\n    return (\n      <div\n        className='app-button'\n        tabIndex={0}\n        onFocus={() => this.handleFocus()}\n      >\n        <button\n          className='app-button-button'\n          style={`background-image: url(${this.props.app.findIcon(56)})`}\n          onBlur={() => this.handleBlur()}\n          onClick={() => this.handleClick()}\n          ref={btn => this.btn = btn}\n        >{this.props.app.name}</button>\n        {this.state.open ? (\n          <AppView\n            app={this.props.app}\n            onClose={() => this.handleFocus()}\n          />\n        ) : null}\n      </div>\n    );\n  }\n  handleClick() {\n    this.setState({focused: true, open: true});\n  }\n  handleFocus() {\n    this.setState({focused: true, open: false});\n    this.btn.focus();\n  }\n  handleBlur() {\n    this.setState({focused: false});\n  }\n}\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Component } from 'inferno';\nimport Focus from './ui/Focus';\nimport AppButton from './AppButton';\nimport './AppList.css';\n\nexport default class AppList extends Component {\n  constructor(props) {\n    super(props);\n    this.apps = [];\n    this.state = {\n      loading: false,\n      loadedPages: 0,\n      isLastPage: false,\n      selected: 0\n    };\n    this.savedFilters = props.filters;\n  }\n  handleKeydown = (e) => {\n    var idx = this.state.selected;\n    if(e.key === 'ArrowUp'){\n      e.preventDefault();\n      idx--;\n      if(idx >= 0){\n        this.setState({\n          selected: idx\n        });\n      }\n      else if(idx === -1 && this.props.canNavigateUp){\n        this.setState({\n          selected: idx\n        });\n        this.props.onNavigateUp();\n      }\n    }\n    else if(e.key === 'ArrowDown'){\n      e.preventDefault();\n      idx++;\n      if(!this.state.loading){\n        if(idx < this.apps.length){\n          this.setState({\n            selected: idx\n          });\n        }\n        if(idx >= (this.apps.length - 2) && !this.state.isLastPage){\n          this.setState({\n            loading: true,\n            selected: idx,\n            isLastPage: false\n          });\n          this.loadNextPage();\n        }\n      }\n    }\n  }\n  componentDidMount() {\n    document.addEventListener('keydown', this.handleKeydown);\n  }\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeydown);\n  }\n  loadNextPage(after) {\n    const nextPage = this.state.loadedPages + 1;\n    return this.props.store.getApps(this.props.filters, (nextPage-1)*10, 10)\n    .then(({apps, isLastPage}) => {\n      console.log('[AppList] Is last page:', isLastPage);\n      this.apps = this.apps.concat(apps);\n      this.setState({\n        loading: false,\n        loadedPages: nextPage,\n        isLastPage\n      });\n    }).catch(e => {\n      console.error('Failed to load next page', e);\n      setTimeout(() => {\n        this.loadNextPage();\n      }, 3000);\n    });\n  }\n  renderApps() {\n    if(this.props.filters !== this.savedFilters){\n      this.savedFilters = this.props.filters;\n      this.apps = [];\n      this.loading = false;\n      this.setState({\n        loading: false,\n        loadedPages: 0,\n        isLastPage: false,\n        selected: 0\n      });\n      return;\n    }\n    if(this.state.loadedPages === 0){\n      if(!this.loading){\n        this.loading = true;\n        this.loadNextPage();\n      }\n      return 'Loading...';\n    }\n    if(this.apps.length === 0){\n      return (\n        <div className='AppListEmpty p-pri'>No results.</div>\n      );\n    }\n    return this.apps.map((app, i) => {\n      return (\n        <Focus\n          isActive={this.props.useFocus && this.state.selected === i}\n          settings={{\n            behavior: 'smooth',\n            block: 'center',\n            inline: 'start',\n            duration: 600\n          }}\n        >\n          <AppButton app={app} />\n        </Focus>\n      );\n    });\n  }\n  render() {\n    return (\n      <div className='AppList'>{this.renderApps()}</div>\n    );\n  }\n}\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Component } from 'inferno';\nimport { findDOMNode } from 'inferno-extras';\nimport TextInput from './ui/TextInput';\nimport SoftKey from './ui/SoftKey';\nimport AppList from './AppList';\nimport './Search.css';\n\nexport default class Search extends Component {\n  constructor(props){\n    super(props);\n    this.state = {\n      keywords: [],\n      searchActive: true\n    };\n    this.appList = null;\n    this.search = '';\n  }\n  handleKeydown = (e) => {\n    if(e.key === 'Backspace' && this.props.onClose){\n      e.preventDefault();\n      this.props.onClose();\n    }\n  }\n  handleKeyup = (e) => {\n    if(e.key === 'Enter' && this.state.searchActive){\n      this.updateKeywords();\n    }\n  }\n  activateSearch() {\n    var node = findDOMNode(this.inp);\n    if(node){\n      node.focus();\n      this.setState({\n        searchActive: true\n      });\n    }\n  }\n  componentDidMount() {\n    this.activateSearch();\n    document.addEventListener('keydown', this.handleKeydown);\n    document.addEventListener('keyup', this.handleKeyup);\n  }\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeydown);\n    document.removeEventListener('keyup', this.handleKeyup);\n  }\n  render() {\n    if(!this.appList){\n      this.appList = this.state.keywords.length > 0 ?\n        <AppList\n          store={this.props.store}\n          filters={{keywords: this.state.keywords}}\n          useFocus={true}\n          canNavigateUp={true}\n          onNavigateUp={() => this.activateSearch()}\n        /> :\n        <div className='SearchPlaceholder p-pri'>\n          Please enter a search term\n        </div>\n    }\n    return (\n      <div className='Search'>\n        <TextInput\n          onChange={() => this.search = this.inp.props.value}\n          onFocus={() => this.setState({searchActive: true})}\n          onBlur={() => this.setState({searchActive: false})}\n          ref={inp => this.inp = inp}\n        />\n        {this.appList}\n        <SoftKey\n          leftText=''\n          centerText={this.state.searchActive ? 'Search' : 'Select'}\n          rightText=''\n        />\n      </div>\n    );\n  }\n  updateKeywords() {\n    const reg = /[.,; ]+/ig;\n    this.appList = null;\n    this.setState({\n      keywords: this.search.replace(reg, ' ').split(' ').filter(a => a)\n    });\n  }\n}\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass AppStore {}\nclass StoreApp {}\n\nexport { AppStore, StoreApp }\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { AppStore, StoreApp } from '../AppStore';\nimport compareVersions from 'compare-versions';\n\nconst BHACKERS_SERVERS = [\n  \"https://banana-hackers.gitlab.io/store-db\",\n  \"https://bananahackers.github.io/store-db\",\n];\nconst BHACKERS_RATINGS = [\n  \"https://bhackers.uber.space/srs/v1\",\n];\n\nfunction request(meth, url, rtype, data, progress){\n  return new Promise((resolve, reject) => {\n    var xhr = new XMLHttpRequest({mozSystem: true});\n    xhr.open(meth, url, true);\n    xhr.responseType = rtype;\n    xhr.ontimeout = function(){\n      reject(new Error('Request Timeout'));\n    }\n    xhr.onload = function(){\n      if(xhr.status === 200){\n        resolve(xhr.response);\n      }\n      else if(xhr.status > 200 && xhr.status < 300){\n        resolve(null);\n      }\n      else {\n        reject(new Error(`Got HTTP ${xhr.status} status`));\n      }\n    }\n    xhr.onprogress = function(e){\n      if(progress) progress(e.loaded, e.total);\n    }\n    xhr.onerror = function(e){\n      reject(new Error('Request Failure'));\n    }\n    xhr.send(data);\n  });\n}\n\nasync function countDownload(rating_servers, slug){\n  for(let srv of rating_servers){\n    try {\n      let response = await request('GET', srv + '/download_counter/count/' +\n        slug);\n      if(response !== 'OK') throw new Error(response);\n    }\n    catch(e) {\n      console.error(`Server ${srv} failed with`, e);\n    }\n  }\n}\n\nasync function loadSRSData(rating_servers){\n  const reg = /[^a-z]/g;\n  const saveName = 'bhv2srs-' + rating_servers[0].replace(reg, '$');\n  for(let srv of rating_servers){\n    try {\n      let response = await request('GET', srv + '/download_counter');\n      let obj = JSON.parse(response);\n      localStorage.setItem(saveName, response);\n      return obj;\n    }\n    catch(e) {\n      console.error(`Server ${srv} failed with`, e);\n    }\n  }\n  const saved = localStorage.getItem(saveName);\n  if(saved){\n    return JSON.parse(saved);\n  }\n  throw new Error('Could not load SRS data');\n}\n\nasync function loadAppData(servers){\n  for(let srv of servers){\n    try {\n      let response = await request('GET', srv + '/data.json', 'string', null);\n      let obj = JSON.parse(response);\n      localStorage.setItem('bhv2-save', response);\n      return obj;\n    }\n    catch(e) {\n      console.error(`Server ${srv} failed with`, e);\n    }\n  }\n  if(localStorage.getItem('bhv2-save')){\n    return JSON.parse(localStorage.getItem('bhv2-save'));\n  }\n  throw new Error('Could not load data');\n}\n\nasync function loadData(servers, rating_servers){\n  let data = await loadAppData(servers);\n  try {\n    data.downloadCount = await loadSRSData(rating_servers);\n  }\n  catch(e) {\n    console.error('SRS error', e);\n  }\n  if(!data.downloadCount){\n    data.downloadCount = {};\n  }\n  return data;\n}\n\nclass BHackersV2App extends StoreApp {\n  constructor(ratings, data, downloadCount, dataVersion){\n    super();\n    this._data = data;\n    this._dataVersion = dataVersion;\n    this._downloadCount = downloadCount || 0;\n    this.ratings = ratings;\n    this.blobPromise = this.manifestPromise = null;\n  }\n  get name() {\n    return this._data.name;\n  }\n  get description() {\n    return this._data.description;\n  }\n  loadManifest() {\n    if(this._dataVersion < 3) return Promise.resolve({\n      version: this._data.download.version\n    });\n\n    if(!this.manifestPromise){\n      this.manifestPromise = request(\n        'GET', this._data.download.manifest, 'string', null\n      ).then(str => Promise.resolve(JSON.parse(str)));\n    }\n    return this.manifestPromise;\n  }\n  getExtendedMetadata() {\n    return this.loadManifest().then(mf => Promise.resolve({\n      developer: {\n        name: this._data.author.map(a => a.replace(/\\s*<[^>]*>$/, ''))\n              .join(', '),\n      },\n      source: this._data.git_repo,\n      has_ads: this._data.has_ads,\n      has_tracking: this._data.has_tracking,\n      license: this._data.license,\n      type: this._data.type,\n      version: mf.version,\n      download_count: this._downloadCount\n    }));\n  }\n  findIcon(size) {\n    return this._data.icon;\n  }\n  downloadPackage() {\n    if(this.blobPromise)\n      return this.blobPromise;\n    return this.blobPromise = request(\n      'GET', this._data.download.url, 'blob', null, null\n    );\n  }\n  getInstallationMethod() {\n    return ['importPackage', async (reportProgress) => {\n      if(!this.blobPromise){\n        this.blobPromise =\n          request('GET', this._data.download.url, 'blob', null,\n            (loaded, total) => {\n              reportProgress('Downloading', Math.floor(loaded/total*100));\n            });\n      }\n      countDownload(this.ratings, this._data.slug.toLowerCase());\n      this._downloadCount++;\n      const manifest = await this.loadManifest();\n      return {args: [await this.blobPromise, manifest.origin]};\n    }];\n  }\n  getIdentificationMethod() {\n    if(this._dataVersion < 3){\n      return ['checkImported', async () => {\n        if(!this.blobPromise){\n          this.blobPromise =\n            request('GET', this._data.download.url, 'blob', null);\n        }\n        return {args: [await this.blobPromise, this._data.slug]};\n      }];\n    }\n    return ['checkInstalled', async () => {\n      const manifest = await this.loadManifest();\n      return {args: [\n        this._data.download.manifest,\n        manifest.type === 'web' && (manifest.origin || this._data.slug),\n        manifest.name\n      ]};\n    }];\n  }\n  checkUpdatable(version) {\n    return this.loadManifest().then(mf => Promise.resolve(\n      (version && mf.version) ?\n      (compareVersions(mf.version, version) > 0) : false\n    ));\n  }\n}\n\nexport default class BHackersV2Store extends AppStore {\n  constructor(\n    servers = BHACKERS_SERVERS,\n    ratings = BHACKERS_RATINGS,\n    name = 'B-Hackers Store'\n  ) {\n    super();\n    this.servers = servers;\n    this.ratings = ratings;\n    this.name = name;\n  }\n  load() {\n    return loadData(this.servers, this.ratings).then(data => {\n      this._data = data;\n      console.log('[bhackers-v2] Got data', data);\n      if(data.version < 3){\n        console.log('[bhackers-v2] Old database version detected');\n      }\n      else if(data.version > 3){\n        console.warn('[bhackers-v2] Database version too new!');\n      }\n      this.categories = [{\n        name: 'Most downloaded', id: '$popular', special: true\n      }].concat(Object.keys(data.categories).map(ctg => {\n        return { name: data.categories[ctg].name, id: ctg };\n      }));\n    });\n  }\n  getApps(filter, start, count) {\n    var origSet = this._data.apps;\n    if(filter.keywords){\n      console.log('[bhackers-v2] Keywords:', filter.keywords);\n      origSet = origSet.map(app => {\n        var score = 0;\n\n        filter.keywords.forEach(kw => {\n          kw = kw.toLowerCase();\n\n          if(app.name.toLowerCase() === kw) score += 5;\n          else if(app.name.toLowerCase().includes(kw)) score += 2;\n\n          app.meta.tags.replace(/; */i, ';').split(';').forEach(tag => {\n            if(tag.toLowerCase() === kw) score += 3;\n            else if(tag.toLowerCase().includes(kw)) score += 1;\n          });\n\n          if(app.description.toLowerCase().includes(kw)) score += 2;\n        });\n\n        var new_app = Object.create(app);\n        new_app.searchScore = score;\n        return new_app;\n      });\n    }\n    var filteredSet = origSet.filter(app => {\n      var match = true;\n      if(filter.categories){\n        if(filter.categories[0].id !== '$popular'){\n          match &= filter.categories.some(\n            ct => app.meta.categories.includes(ct.id));\n        }\n      }\n      if(filter.keywords){\n        match &= (app.searchScore > 0);\n      }\n      return match;\n    });\n    if(filter.categories && filter.categories[0].id === '$popular'){\n      filteredSet.sort((a, b) => {\n        return (this._data.downloadCount[b.slug.toLowerCase()] || 0) -\n          (this._data.downloadCount[a.slug.toLowerCase()] || 0);\n      });\n    }\n    if(filter.keywords){\n      filteredSet.sort((a, b) => b.searchScore - a.searchScore);\n    }\n    return Promise.resolve({\n      apps: filteredSet\n        .slice(start, start+count)\n        .map(app => new BHackersV2App(\n          this.ratings,\n          app,\n          this._data.downloadCount[app.slug.toLowerCase()],\n          this._data.version\n        )),\n      isLastPage: start+count >= filteredSet.length\n    });\n  }\n}\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Buffer } from 'buffer';\nimport * as hawk from 'hawk';\n\nexport default class Requester {\n  constructor(auth, api, dev){\n    this.auth = auth;\n    this.api = api;\n    this.dev = dev;\n    switch(auth.method){\n      case 'api-key':\n        this.send({\n          method: 'POST',\n          data: {\n            brand: dev.brand,\n            device_id: dev.imei,\n            device_type: dev.type,\n            model: dev.model,\n            os: dev.os,\n            os_version: dev.version,\n            reference: dev.cu\n          },\n          path: '/v3.0/applications/' + api.app.id + '/tokens',\n          headers: {\n            'Authorization': 'Key ' + auth.key\n          },\n          type: 'json'\n        }).then(token => {\n          this.token = token;\n          this.onload();\n        }).catch(e => {\n          this.onerror(e);\n        });\n        break;\n      default:\n        this.onerror(new Error('Unknown authentication method: ' +\n          auth.method));\n        break;\n    }\n  }\n  send(req){\n    return new Promise((resolve, reject) => {\n      if(!req.path)\n        reject(new TypeError('request missing path'));\n      else if(!req.method)\n        reject(new TypeError('request missing method'));\n      else {\n        var xhr = new XMLHttpRequest({mozSystem: true});\n        var path = req.path;\n        var payload = ['POST', 'PUT'].includes(req.method) ? (\n          (req.contentType && req.contentType !== 'application/json') ?\n          req.data : JSON.stringify(req.data)\n        ) : null;\n        var hawkinfo;\n        if(path[0] === '/'){\n          path = this.api.server.url + path;\n        }\n        if(req.type === 'blob' || req.type === 'arraybuffer')\n          xhr.responseType = req.type;\n\n        xhr.open(req.method, path, true);\n        if('object' === typeof req.headers){\n          Object.keys(req.headers).forEach(name => {\n            xhr.setRequestHeader(name, req.headers[name]);\n          });\n        }\n        xhr.setRequestHeader('Kai-API-Version', this.api.ver);\n        xhr.setRequestHeader('Kai-Request-Info',\n          'ct=\"wifi\", rt=\"auto\", utc=\"' +\n          Date.now() + '\", utc_off=\"1\", ' +\n          'mcc=\"' + this.dev.mcc + '\", ' +\n          'mnc=\"' + this.dev.mnc + '\", ' +\n          'net_mcc=\"null\", ' +\n          'net_mnc=\"null\"'\n        );\n        xhr.setRequestHeader('Kai-Device-Info',\n          'imei=\"' + this.dev.imei + '\", curef=\"' + this.dev.cu + '\"');\n        xhr.setRequestHeader('User-agent', this.dev.ua);\n        xhr.setRequestHeader('Content-type',\n          req.contentType || 'application/json');\n        if(this.token){\n          hawkinfo = {\n            credentials: {\n              id: this.token.kid,\n              algorithm: 'sha256',\n              key: new Buffer(this.token.mac_key, 'base64')\n            }\n          };\n          if(payload){\n            hawkinfo.payload = payload;\n            hawkinfo.contentType = req.contentType || 'application/json';\n          }\n          xhr.setRequestHeader('Authorization',\n            hawk.client.header(path, req.method, hawkinfo).header);\n        }\n        xhr.onerror = function(){\n          reject(new Error('request error'));\n        }\n        xhr.onprogress = function(e){\n          if(req.reportProgress)\n            req.reportProgress('Downloading', Math.floor(\n              e.loaded / e.total * 100\n            ));\n        }\n        xhr.onload = function(){\n          try {\n            var msg = '';\n            if(xhr.status !== 200 && xhr.status !== 201 && xhr.status !== 204){\n              if(xhr.responseText){\n                try {\n                  var error = JSON.parse(xhr.responseText);\n                  msg = ' ' + error.desc + ': ' + error.cause;\n                } catch(e) {\n                  msg = ' ' + xhr.responseText;\n                }\n              }\n              reject(`request error ${xhr.status}: ${xhr.statusText} ${msg}`);\n            }\n            if(req.type === 'json'){\n              resolve(JSON.parse(xhr.responseText));\n            }\n            else {\n              resolve(xhr.response);\n            }\n          }\n          catch(e) {\n            reject(e);\n          }\n        }\n        xhr.send(payload);\n      }\n    });\n  }\n}\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { AppStore, StoreApp } from '../AppStore';\nimport compareVersions from 'compare-versions';\nimport Requester from './kaistone-requester';\n\nfunction getKaiOSVersion(){\n  var kaiUA = /(KAIOS|B2GOS)\\/([^ ]*)/.exec(navigator.userAgent);\n  if(kaiUA) return kaiUA[2];\n  else return '2.5.4';\n}\n\n\nclass KaiStoneApp extends StoreApp {\n  constructor(data, requester){\n    super();\n    this.requester = requester;\n    this._data = data;\n  }\n  get name() {\n    return this._data.display || this._data.name;\n  }\n  get description() {\n    return this._data.description;\n  }\n  findIcon(preferredSize) {\n    if(this._data.thumbnail_url) return this._data.thumbnail_url;\n\n    var sizes = Object.keys(this._data.icons);\n    var bestSize = null, currentDiff = null;\n    sizes.forEach(size => {\n      var diff = preferredSize - size;\n      if(diff < 0) diff = -diff;\n      if(currentDiff === null || diff < currentDiff){\n        bestSize = size;\n        currentDiff = diff;\n      }\n    });\n    if(!bestSize){\n      return null;\n    }\n    return this._data.icons[bestSize];\n  }\n  loadManifest() {\n    if(!this.manifestPromise){\n      this.manifestPromise = this.requester.send({\n        method: 'GET',\n        path: this._data.manifest_url,\n        type: 'json'\n      });\n    }\n    return this.manifestPromise;\n  }\n  getExtendedMetadata() {\n    var getDeveloper;\n    if('string' === typeof this._data.developer &&\n      'string' === typeof this._data.developer_url)\n    {\n      getDeveloper = Promise.resolve({\n        name: this._data.developer,\n        url: this._data.developer_url\n      });\n    }\n    else {\n      getDeveloper = this.loadManifest().then(mf => {\n        return Promise.resolve(mf.developer);\n      });\n    }\n    return getDeveloper.then(developer => {\n      return Promise.resolve({\n        developer,\n        version: this._data.version,\n        type: this._data.type\n      });\n    });\n  }\n  async downloadPackage() {\n    if(this.blobPromise)\n      return await this.blobPromise;\n    return await (this.blobPromise = this.requester.send({\n      method: 'GET',\n      path: this._data.package_path ||\n        (await this.loadManifest()).package_path,\n      type: 'blob'\n    }));\n  }\n  getInstallationMethod() {\n    return ['installPackage', async (reportProgress) => {\n      if(!this.blobPromise){\n        this.blobPromise = this.requester.send({\n          method: 'GET',\n          path: this._data.package_path ||\n            (await this.loadManifest()).package_path,\n          type: 'blob',\n          reportProgress\n        });\n      }\n      return {args: [\n        this._data.manifest_url,\n        await this.blobPromise,\n        null, //this._data.id\n      ]};\n    }];\n  }\n  getIdentificationMethod() {\n    return ['checkInstalled', async () => {\n      const manifest = await this.loadManifest();\n      return {args: [\n        this._data.manifest_url,\n        this._data.type === 'web' && (manifest.origin || this._data.id),\n        manifest.name\n      ]};\n    }];\n  }\n  checkUpdatable(version) {\n    return Promise.resolve(\n      version ? (compareVersions(this._data.version, version) > 0) : false\n    );\n  }\n}\n\nexport default class KaiStone extends AppStore {\n  constructor(server='https://api.kaiostech.com', name='KaiStone (KaiStore)') {\n    super();\n    this.name = name;\n    this.settings = {\n      dev: {\n        model: 'GoFlip2',\n        imei: '123456789012345',\n        type: 999999,\n        brand: 'AlcatelOneTouch',\n        os: 'KaiOS',\n        version: getKaiOSVersion(),\n        ua: 'Mozilla/5.0 (Mobile; GoFlip2; rv:48.0) '\n          + 'Gecko/48.0 Firefox/48.0 KAIOS/' + getKaiOSVersion(),\n        cu: '4044O-2BAQUS1-R',\n        mcc: '0',\n        mnc: '0'\n      },\n      api: {\n        app: {\n          id: 'CAlTn_6yQsgyJKrr-nCh',\n          name: 'KaiOS Plus',\n          ver: '2.5.4'\n        },\n        server: {\n          url: server\n        },\n        ver: '3.0'\n      },\n      auth: {\n        method: 'api-key',\n        key: 'baJ_nea27HqSskijhZlT'\n      }\n    };\n  }\n  load() {\n    return this.loadPromise || (\n      this.loadPromise = new Promise((resolve, reject) => {\n        this.requester = new Requester(\n          this.settings.auth, this.settings.api, this.settings.dev\n        );\n        this.requester.onload = () => {\n          this.requester.send({\n            method: 'GET',\n            path: '/v3.0/categories',\n            type: 'json'\n          }).then(ctgs => {\n            console.log('[kaistone] Categories', ctgs);\n            this.categories = ctgs;\n            resolve();\n          }).catch(reject);\n        }\n        this.requester.onerror = e => {\n          reject(e);\n        }\n      })\n    );\n  }\n  getApps(filter, start, count) {\n    var isSearch = false, clientSideCategoryFilter = false;\n    var path = '/kc_ksfe/v1.0/apps';\n    if(Array.isArray(filter.keywords)){\n      isSearch = true;\n      path =\n        `${this.settings.api.server.url.replace('api', 'search')}/v3/_search`;\n    }\n    path += '?bookmark=false';\n    path += '&imei=' + this.settings.dev.imei;\n    if(isSearch){\n      path += '&platform=' + this.settings.dev.version;\n      path += '&page=' + Math.floor(start/count);\n      path += '&size=' + count;\n    }\n    else {\n      path += '&os=' + this.settings.dev.version;\n      path += '&page_size=' + count;\n      path += '&page_num=' + (1+Math.floor(start/count));\n    }\n    path += '&mnc=' + this.settings.dev.mnc + '&mcc=' + this.settings.dev.mcc;\n    if(filter.categories && filter.categories.length > 0){\n      if(filter.categories.length === 1)\n        path += '&category=' + encodeURIComponent(filter.categories[0].code);\n      else\n        clientSideCategoryFilter = true;\n    }\n    if(isSearch){\n      path += '&query=' + filter.keywords.join(' ');\n      path += '&locale=' + encodeURIComponent(navigator.language);\n    }\n    return this.requester.send({\n      method: 'GET',\n      type: 'json',\n      path\n    }).then(data => {\n      var filtered = (isSearch ? data.organic : data.apps).filter(app => {\n        var match = true;\n        if(clientSideCategoryFilter){\n          match &= filter.categories.some(\n            ct => app.category_list.includes(ct.code));\n        }\n        return match;\n      });\n      return Promise.resolve({\n        apps: filtered.map(app => new KaiStoneApp(app, this.requester)),\n        isLastPage: isSearch ? data.page === data.total_pages-1 : data.last_page\n      });\n    });\n  }\n}\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Component } from 'inferno';\nimport TabView from './ui/TabView';\nimport SoftKey from './ui/SoftKey';\nimport SelectPopup from './ui/SelectPopup';\nimport RadioButtonListItem from './ui/RadioButtonListItem';\nimport toast from './Toaster';\nimport Search from './Search';\nimport AppList from './AppList';\nimport BHackersV2Store from './backend/appstore/bhackers-v2';\nimport KaiStone from './backend/appstore/kaistone';\nimport './Store.css';\n\nexport default class Store extends Component {\n  constructor(props) {\n    super(props);\n\n    this.stores = [\n      new BHackersV2Store(),\n      new BHackersV2Store([\n        'https://storedb.opengiraffes.top',\n      ], [\n        'https://opengiraffes-rating.herokuapp.com',\n      ], 'OpenGiraffes (China)'),\n      new KaiStone(),\n      new KaiStone('https://api.test.kaiostech.com', 'KaiStone test'),\n      //new KaiStone('https://api.test1.kaiostech.com', 'KaiStone test'),\n    ];\n    this.state = {\n      store: 0,\n      loaded: false,\n      loading: false,\n      searchOpen: false,\n      error: null\n    };\n  }\n  storeLoadComplete(idx) {\n    toast(this.stores[idx].name);\n    if(this.state.store === idx)\n      this.setState({loaded: true, loading: false});\n  }\n  render() {\n    const popup = this.state.selecting && <SelectPopup\n      header=\"Select source\"\n      onClose={() => this.setState({\n        selecting: false\n      })}\n    >{this.stores.map((store, index) =>\n      <RadioButtonListItem\n        isChecked={index === this.state.store}\n        onSelect={() => this.setState({\n          store: index,\n          loaded: false,\n          loading: false,\n          selecting: false,\n          error: null\n        })}\n      >\n        {store.name}\n      </RadioButtonListItem>\n    )}</SelectPopup>;\n\n    if(!this.state.loaded){\n      if(this.state.error){\n        return (\n          <div className='Store'>\n            <div className='StoreLoadFailed'>\n              <h3>Loading failed</h3>\n              {this.state.error}\n            </div>\n            <SoftKey\n              leftText='Quit'\n              centerText='Retry'\n              rightText='Switch'\n              leftCallback={() => window.close()}\n              centerCallback={() => this.setState({\n                loaded: false,\n                loading: false,\n                error: null\n              })}\n              rightCallback={() => this.setState({\n                selecting: true\n              })}\n            />\n            {popup}\n          </div>\n        );\n      }\n      if(!this.state.loading){\n        this.setState({loading: true, loaded: false, error: null});\n        this.stores[this.state.store]\n          .load()\n          .then(() => this.storeLoadComplete(this.state.store))\n          .catch(e => {\n            toast('Failed');\n            this.setState({\n              loading: false,\n              loaded: false,\n              error: e.toString()\n            });\n          });\n      }\n      return (\n        <div className='Store'>\n          Loading...\n        </div>\n      );\n    }\n\n    if(this.state.searchOpen){\n      return (\n        <Search\n          onClose={() => this.setState({ searchOpen: false})}\n          store={this.stores[this.state.store]}\n        />\n      );\n    }\n\n    const tabs = this.stores[this.state.store].categories.map(ctg => (\n      <AppList\n        store={this.stores[this.state.store]}\n        filters={{categories: [ctg]}}\n        useFocus={!this.state.selecting}\n      />\n    ));\n    const labels = this.stores[this.state.store].categories.map(\n      ctg => ctg.name);\n    return (\n      <div className='Store'>\n        <TabView tabLabels={labels}>{tabs}</TabView>\n        <SoftKey\n          leftIcon='kai-icon-search'\n          centerText='Select'\n          rightText='Switch'\n          leftCallback={() => this.setState({ searchOpen: true })}\n          rightCallback={() => this.setState({\n            selecting: true\n          })}\n        />\n        {popup}\n      </div>\n    );\n  }\n}\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Component } from 'inferno';\nimport TextInput from './ui/TextInput';\nimport './Setup.css';\n\nclass Setup extends Component {\n  constructor(props) {\n    super(props);\n    this.cb = props.onSetup;\n  }\n  render() {\n    return (\n      <div className='Setup'>\n        <TextInput label='Login' />\n      </div>\n    );\n  }\n  handleSetupComplete() {\n    this.cb();\n  }\n}\n\nexport default Setup;\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Component } from 'inferno';\nimport Store from './Store'\nimport Setup from './Setup'\nimport './App.css';\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      setupDone: true\n    };\n  }\n  render() {\n    if(!this.state.setupDone){\n      return (\n        <div className='App'>\n          <Setup onSetup={() => this.setState({setupDone: true})} />\n        </div>\n      );\n    }\n    else {\n      return (\n        <div className='App'>\n          <Store />\n        </div>\n      );\n    }\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { render } from 'inferno';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nif(navigator.mozSettings){\n  /* Force debug mode to be enabled */\n  navigator.mozSettings.createLock().set({\n    'debugger.remote-mode': 'adb-devtools'\n  });\n}\n\nrender(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { installers } from './install-app';\n\nvar installStatusUpdate = {\n  callbacks: [],\n  subscribe(cb) {\n    this.callbacks.push(cb);\n  },\n  unsubscribe(cb) {\n    this.callbacks = this.callbacks.filter(cb2 => cb2 !== cb);\n  },\n  emit() {\n    this.callbacks.forEach(cb => cb());\n  }\n};\n\nexport default async function checkInstalled(app){\n  let error = new Error('No installers found');\n  let [method, loader] = app.getIdentificationMethod();\n  for(let i = 0; i < installers.length; i++){\n    let result;\n    result = await loader();\n\n    try {\n      return await installers[i][method].apply(installers[i], result.args);\n    } catch(e) {\n      // Don't spam console with fallback errors\n      //console.error('CheckInstall error', e);\n      error = e;\n    }\n  }\n  throw error;\n}\n\nexport { installStatusUpdate };\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport JSZip from 'jszip';\nfunction pack(data){\n  var zip = new JSZip();\n  zip.file('metadata.json', JSON.stringify({\n    manifestURL: data.manifestURL\n  }));\n  zip.file('application.zip', data.pkg);\n  return zip.generateAsync({type: 'blob'});\n}\nasync function unpack(pkg){\n  var zip = await JSZip.loadAsync(pkg);\n  var metafile = zip.file('metadata.json');\n  if(!metafile) throw new Error('Package is missing metadata file');\n  var metadata = JSON.parse(await metafile.async('string'));\n  if(!metadata.manifestURL) throw new Error('Metadata is missing manifestURL');\n  var appfile = zip.file('application.zip');\n  if(!appfile) throw new Error('Package is missing application.zip');\n  return {\n    manifestURL: metadata.manifestURL,\n    pkg: await appfile.async('blob')\n  };\n}\nasync function extractManifest(pkg){\n  var zip = await JSZip.loadAsync(pkg);\n  var manifest = zip.file('manifest.webapp');\n  if(!manifest) throw new Error('Package is missing manifest');\n  return JSON.parse(await manifest.async('string'));\n}\n\nexport { pack, unpack, extractManifest }\n","/*\n * Copyright (C) 2021 Affe Null <affenull2345@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { pack, unpack, extractManifest } from './pkgutils';\n\nclass Installer {\n  importPackage(installedId, pkg, idHint, calledFromImplementation) {\n    if(calledFromImplementation){\n      return Promise.reject(\n        new Error('This installer cannot import apps'));\n    }\n    return unpack(pkg).then(unpacked => {\n      return this.installPackage(installedId,\n        unpacked.manifestURL, unpacked.pkg, idHint, true);\n    });\n  }\n  async checkImported(pkg, idHint, calledFromImplementation) {\n    if(calledFromImplementation){\n      throw new Error('This installer cannot checkImported');\n    }\n    var unpacked = await unpack(pkg);\n    return this.checkInstalled(unpacked.manifestURL, idHint, true) ||\n      this.checkInstalledByOrigin((await extractManifest(unpacked.pkg)).origin);\n  }\n  installPackage(installedId, manifestURL, pkg, idHint, calledFromImplementation) {\n    if(calledFromImplementation){\n      return Promise.reject(\n        new Error('This installer cannot install packages'));\n    }\n    return pack({manifestURL, pkg}).then(packed => {\n      return this.importPackage(installedId, packed.pkg, idHint, true);\n    });\n  }\n  installHosted(manifestURL) {\n    return Promise.reject(\n      new Error('This installer does not support hosted apps'));\n  }\n  checkInstalled(manifest_url, idHint, calledFromImplementation) {\n    return Promise.reject(new Error('This installer cannot checkInstalled'));\n  }\n  checkInstalledByOrigin(origin) {\n    return false;\n  }\n}\n\nclass InstalledApp {}\n\nexport { Installer, InstalledApp }\n"],"sourceRoot":""}